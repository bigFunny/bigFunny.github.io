<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Spring | BigFunny</title><meta name="keywords" content="Spring"><meta name="author" content="BigFunny"><meta name="copyright" content="BigFunny"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="这篇文章主要介绍spring框架的使用">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring">
<meta property="og:url" content="https://bigfunny.github.io/post/6c92115f.html">
<meta property="og:site_name" content="BigFunny">
<meta property="og:description" content="这篇文章主要介绍spring框架的使用">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://images4.alphacoders.com/682/682865.jpg">
<meta property="article:published_time" content="2022-10-26T16:45:57.000Z">
<meta property="article:modified_time" content="2022-11-27T11:31:04.388Z">
<meta property="article:author" content="BigFunny">
<meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://images4.alphacoders.com/682/682865.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://bigfunny.github.io/post/6c92115f"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"WYJ7O7NN9W","apiKey":"7a3b1b6bd947b5c887fd129554b0b0d3","indexName":"Blong","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":100,"languages":{"author":"作者: BigFunny","link":"链接: ","source":"来源: BigFunny","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Spring',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-27 19:31:04'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/rightMenu.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">40</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list faa-float animated"></i><span> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-bilibili"></i><span> 番剧</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video faa-float animated"></i><span> 电影</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book faa-float animated"></i><span> 书单</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad faa-float animated"></i><span> 游戏</span></a></li><li><a class="site-page child" href="/collect/"><i class="fa-fw fa-sharp fa-solid fa-star"></i><span> 收藏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart card_announcement faa-float animated"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://images4.alphacoders.com/682/682865.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">BigFunny</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list faa-float animated"></i><span> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-bilibili"></i><span> 番剧</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video faa-float animated"></i><span> 电影</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book faa-float animated"></i><span> 书单</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad faa-float animated"></i><span> 游戏</span></a></li><li><a class="site-page child" href="/collect/"><i class="fa-fw fa-sharp fa-solid fa-star"></i><span> 收藏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart card_announcement faa-float animated"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Spring</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-26T16:45:57.000Z" title="发表于 2022-10-27 00:45:57">2022-10-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-27T11:31:04.388Z" title="更新于 2022-11-27 19:31:04">2022-11-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Spring/">Spring</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">25.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>114分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Spring"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1-Spring概述"><a href="#1-Spring概述" class="headerlink" title="1. Spring概述"></a>1. Spring概述</h1><h2 id="1-1-什么是Spring"><a href="#1-1-什么是Spring" class="headerlink" title="1.1 什么是Spring"></a>1.1 什么是Spring</h2><p>​			Spring是由Rod Johnson组织和开发的一个分层的Java SE&#x2F;EE full-stack（一站式）轻量级开源框架，它以IoC（Inversion of Control，控制反转）和AOP（Aspect Oriented Programming，面向切面编程）为内核，使用基本的JavaBean来完成以前只可能由EJB（Enterprise Java Beans, Java企业Bean）完成的工作，取代了EJB的臃肿、低效的开发模式。</p>
<h2 id="1-2-Spring框架的优点"><a href="#1-2-Spring框架的优点" class="headerlink" title="1.2 Spring框架的优点"></a>1.2 Spring框架的优点</h2><ul>
<li><strong>非侵入式设计</strong></li>
<li><strong>方便解耦、简化开发</strong></li>
<li><strong>支持AOP</strong></li>
<li><strong>支持声明式事务处理</strong></li>
<li><strong>方便程序的测试</strong></li>
<li><strong>方便集成各种优秀框架</strong></li>
<li><strong>降低Java EE API的使用难度</strong></li>
</ul>
<h2 id="1-3-Spring体系结构"><a href="#1-3-Spring体系结构" class="headerlink" title="1.3 Spring体系结构"></a><strong>1.3 Spring体系结构</strong></h2><h3 id="1-Core-Container（核心容器）"><a href="#1-Core-Container（核心容器）" class="headerlink" title="1.Core Container（核心容器）"></a><strong>1.Core Container（核心容器）</strong></h3><ul>
<li><strong>Beans模块：提供了BeanFactory，是工厂模式的经典实现，Spring将管理对象称为Bean。</strong></li>
<li><strong>Core核心模块：提供了Spring框架的基本组成部分，包括IoC和DI功能。</strong></li>
<li><strong>Context-support模块：提供了对第三方库嵌入Spring应用的集成支持，比如缓存（EhCache、Guava、JCache）、邮件服务（JavaMail）、任务调度（CommonJ、Quartz）和模板引擎（FreeMarker、JasperReports、速率）。</strong></li>
<li><strong>SpEL模块：是Spring 3.0后新增的模块，它提供了Spring Expression Language支持，是运行时查询和操作对象图的强大的表达式语言。</strong></li>
</ul>
<h3 id="2-Data-Access-x2F-Integration（数据访问-x2F-集成）"><a href="#2-Data-Access-x2F-Integration（数据访问-x2F-集成）" class="headerlink" title="2.Data Access&#x2F;Integration（数据访问&#x2F;集成）"></a><strong>2.Data Access&#x2F;Integration（数据访问&#x2F;集成）</strong></h3><ul>
<li><p><strong>ORM模块：对流行的对象关系映射API，包括JPA、JDO和Hibernate提供了集成层支持。</strong></p>
</li>
<li><p><strong>OXM模块：提供了一个支持对象&#x2F; XML映射的抽象层实现，如JAXB、Castor、XMLBeans、JiBX和XStream。</strong></p>
</li>
<li><p><strong>JMS模块：指Java消息传递服务，包含使用和产生信息的特性，自4.1版本后支持与Spring-message模块的集成。</strong></p>
</li>
<li><p><strong>Transactions事务模块：支持对实现特殊接口以及所有POJO类的编程和声明式的事务管理。</strong></p>
</li>
</ul>
<h3 id="3-Web"><a href="#3-Web" class="headerlink" title="3.Web"></a><strong>3.Web</strong></h3><ul>
<li><strong>WebSocket模块：Spring 4.0以后新增的模块，它提供了WebSocket和SockJS的实现，以及对STOMP的支持。</strong></li>
<li><strong>Servlet模块：也称为Spring-webmvc模块，包含了Spring的模型—视图—控制器（MVC）和REST Web Services实现的Web应用程序。</strong></li>
<li><strong>Web模块：提供了基本的Web开发集成特性，例如：多文件上传功能、使用Servlet监听器来初始化IoC容器以及Web应用上下文。</strong></li>
<li><strong>Portlet模块：提供了在Portlet环境中使用MVC实现，类似Servlet模块的功能。</strong></li>
</ul>
<h3 id="4．其他模块"><a href="#4．其他模块" class="headerlink" title="4．其他模块"></a><strong>4．其他模块</strong></h3><ul>
<li><p><strong>AOP模块：提供了面向切面编程实现，允许定义方法拦截器和切入点，将代码按照功能进行分离，以降低耦合性。</strong></p>
</li>
<li><p><strong>Aspects模块：提供了与AspectJ的集成功能，AspectJ是一个功能强大且成熟的面向切面编程（AOP）框架。</strong></p>
</li>
<li><p><strong>Instrumentation模块：提供了类工具的支持和类加载器的实现，可以在特定的应用服务器中使用。</strong></p>
</li>
<li><p><strong>Messaging模块：Spring 4.0以后新增的模块，它提供了对消息传递体系结构和协议的支持。</strong></p>
</li>
<li><p><strong>Test模块：提供了对单元测试和集成测试的支持。</strong></p>
</li>
</ul>
<h2 id="1-4-IoC和DI"><a href="#1-4-IoC和DI" class="headerlink" title="1.4 IoC和DI"></a>1.4 IoC和DI</h2><p>​		<strong>控制反转</strong>（Inversion of Control，缩写为<strong>IoC</strong>），是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/254878">面向对象编程</a>中的一种设计原则，可以用来减低计算机<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E4%BB%A3%E7%A0%81/86048">代码</a>之间的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%80%A6%E5%90%88%E5%BA%A6/2603938">耦合度</a>。</p>
<ul>
<li><strong>依赖查找：</strong>容器提供回调接口和上下文条件给组件。EJB和Apache Avalon 都使用这种方式。这样一来，组件就必须使用容器提供的API来查找资源和协作对象，仅有的控制反转只体现在那些回调方法上（也就是上面所说的 类型1）：容器将调用这些回调方法，从而让应用代码获得相关资源。</li>
<li><strong>依赖注入：</strong>组件不做定位查询，只提供普通的Java方法让容器去决定依赖关系。容器全权负责的组件的装配，它会把符合依赖关系的对象通过JavaBean属性或者<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0">构造函数</a>传递给需要的对象。通过JavaBean属性注射依赖关系的做法称为设值方法注入(Setter Injection)；将依赖关系作为构造函数参数传入的做法称为<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%9E%84%E9%80%A0%E5%99%A8">构造器</a>注入（Constructor Injection）</li>
</ul>
<p>​       Spring中IoC，可理解为，传统的程序设计中，调用者<strong>需要</strong>被调用者<strong>协助</strong>时，调用者通过<strong>创建</strong>被调用者<strong>实例</strong>的方式来进行，但是在Spring中，创建被调用者的实例任务，不再是调用者来完成，而是交给<strong>Sring的容器</strong>来实现，控制权得到了反转。</p>
<p>​      依赖注入(DI)，Spring容器将依赖对象注入到bean中，如将Dao层的对象注入到Service层。依赖注入的方式有两种分别是属性setter方法注入和构造方法注入。</p>
<p><strong>属性setter方法注入</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"><span class="comment">//user属性的setter方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.user.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--user对象的bean--&gt;</span>	</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.bigFunny.ioc.dao.User&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--userService对象的bean--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.bigFunny.ioc.service.UserService&quot;</span>&gt;</span></span><br><span class="line">   	<span class="comment">&lt;!--将user注入到userService bean中--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;user&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//通过xml方式创建容器</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> 		  <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//从容器中获取bean对象</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) context.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        userService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>构造方法注入</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.user.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.bigFunny.ioc.dao.User&quot;</span>/&gt;</span></span><br><span class="line"> 	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.bigFunny.ioc.service.UserService&quot;</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--name为构造器中形参的名字 ref为bean的引用--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;user&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//通过xml方式创建容器</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> 		  <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//从容器中获取bean对象</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) context.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        userService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
</br>

<h1 id="2-Spring的Bean"><a href="#2-Spring的Bean" class="headerlink" title="2.Spring的Bean"></a>2.Spring的Bean</h1><h2 id="2-1Bean的配置"><a href="#2-1Bean的配置" class="headerlink" title="2.1Bean的配置"></a>2.1Bean的配置</h2><ul>
<li>XML配置和Properties配置</li>
<li>Bean中常用的标签为id和name，class指定对象的实现类</li>
</ul>
<p><strong>注意：如果Bean未指定id，和name属性，则将class的值作为id使用</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.bigFunny.ioc.dao.User&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//id=User.class</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) context.getBean(User.class);</span><br><span class="line">        user.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2Bean中对象的获取"><a href="#2-2Bean中对象的获取" class="headerlink" title="2.2Bean中对象的获取"></a>2.2Bean中对象的获取</h2><ul>
<li><p>普通方式</p>
</li>
<li><p>静态工厂方式获取</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> User <span class="title function_">getUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> People <span class="title function_">getPeople</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">People</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--使用factory-method确认工厂中的哪个方法--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.bigFunny.ioc.factory.MyBeanFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getUser&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;people&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.bigFunny.ioc.factory.MyBeanFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getPeople&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//创建容器</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//从容器中获得bean对象</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) context.getBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="type">People</span> <span class="variable">people</span> <span class="operator">=</span> (People) context.getBean(<span class="string">&quot;people&quot;</span>);</span><br><span class="line">        user.save();</span><br><span class="line">        people.save();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>实例化工厂方式获取</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> People <span class="title function_">getPeople</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">People</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">&lt;!--    配置工厂--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myBeanFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.bigFunny.ioc.factory.MyBeanFactory&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--   调用工厂方法--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;myBeanFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getUser&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;people&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;myBeanFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getPeople&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//创建容器</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//从容器中获得bean对象</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) context.getBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="type">People</span> <span class="variable">people</span> <span class="operator">=</span> (People) context.getBean(<span class="string">&quot;people&quot;</span>);</span><br><span class="line">        user.save();</span><br><span class="line">        people.save();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3Bean的作用域"><a href="#2-3Bean的作用域" class="headerlink" title="2.3Bean的作用域"></a>2.3Bean的作用域</h2><ul>
<li><p>bean的作用域由<strong>scope属性</strong>来指定</p>
</li>
<li><p>bean的作用域有七种，分别为singleton(默认作用域)，prototype，request，session，globalSession，application，websocket。</p>
</li>
<li><p><strong>singleton</strong>(默认作用域)作用域，其输出结果为一个实例对象</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.bigFunny.ioc.dao.User&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//创建容器</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//从容器中获得bean的静态工厂</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) context.getBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> (User) context.getBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        System.out.println(user2);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>输出结果</strong></p>
<img src="/post/6c92115f/p1.png" class="">
</li>
<li><p><strong>protoype</strong>作用域</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.bigFunny.ioc.dao.User&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//创建容器</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//从容器中获得bean的静态工厂</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) context.getBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> (User) context.getBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        System.out.println(user2);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>输出结果</strong></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1649764985629.png" alt="1649764985629"></p>
</li>
</ul>
<h2 id="2-4-Bean的生命周期"><a href="#2-4-Bean的生命周期" class="headerlink" title="2.4 Bean的生命周期"></a>2.4 Bean的生命周期</h2><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1649765430834.png" alt="1649765430834"></p>
<p>（1）根据配置情况调用Bean构造方法或工厂方法<strong>实例化Bean</strong>。</p>
<p>（2）利用<strong>依赖注入</strong>完成Bean中所有属性值的配置注入。</p>
<p>（3）如果Bean实现了<strong>BeanNameAware</strong>接口，则Spring<strong>调用Bean的setBeanName()方法传入当前Bean的id值</strong>。</p>
<p>（4）如果Bean实现了<strong>BeanFactoryAware</strong>接口，则Spring<strong>调用setBeanFactory()方法传入当前工厂实例的引用</strong>。</p>
<p>（5）如果Bean实现了<strong>ApplicationContextAware</strong>接口，则Spring调用<strong>setApplicationContext()方法传入当前ApplicationContext实例的引用</strong>。</p>
<p>（6）如果<strong>BeanPostProcessor和Bean关联</strong>，则Spring将<strong>调用该接口的预初始化方法postProcessBeforeInitialzation()<strong>对</strong>Bean进行加工操作</strong>，这个非常重要，Spring的<strong>AOP</strong>就是用它实现的。</p>
<p>（7）如果Bean实现了<strong>InitializingBean</strong>接口，则Spring将调用<strong>afterPropertiesSet()方法</strong>。</p>
<p>（8）如果在配置文件中通过<strong>init-method属性指定了初始化方法</strong>，则调用该初始化方法。</p>
<p>（9）如果有<strong>BeanPostProcessor和Bean关联</strong>，则Spring将调用该接口的初始化方法<strong>post ProcessAfterInitialization()<strong>。此时，</strong>Bean已经可以被应用系统使用了</strong>。</p>
<p>（10）如果在<bean> 中指定了该Bean的作用范围为<strong>scope&#x3D;”singleton”<strong>，则将该</strong>Bean放入Spring IoC的缓存池</strong>中，将触发Spring对该Bean的生命周期管理；如果在<bean>中指定了该Bean的作用范围为<strong>scope&#x3D;”prototype”<strong>，则将该Bean交给调用者，</strong>调用者管理该Bean的生命周期</strong>，Spring不再管理该Bean。</p>
<p>（11）如果Bean实现了<strong>DisposableBean</strong>接口，则Spring会调用<strong>destory()<strong>方法将Spring中的</strong>Bean销毁</strong>；如果在配置文件中通过<strong>destory-method</strong>属性指定了<strong>Bean的销毁方法</strong>，则Spring将调用该方法进行销毁。</p>
<h2 id="2-5-Bean的装配方式"><a href="#2-5-Bean的装配方式" class="headerlink" title="2.5 Bean的装配方式"></a>2.5 Bean的装配方式</h2><p><strong>xml装配</strong></p>
<p>​		Spring实例化Bean过程中，<strong>先</strong>调用默认构造器实例化Bean，<strong>然后</strong>通过<strong>反射方式</strong>调用setter方法来注入属性值。因此值注入方式必须满足两点。</p>
<ul>
<li>Bean类必须提供一个默认构造器</li>
<li>Bean类必须为需要注入的属性提供一个setter方法</li>
</ul>
<p><strong>Annotation(注解)</strong>  <strong>注入</strong></p>
<ul>
<li>常用注解</li>
</ul>
<p><img src="file:///C:\Users\Administrator\AppData\Local\Temp\ksohtml4104\wps1.jpg" alt="img"></p>
<p><img src="file:///C:\Users\Administrator\AppData\Local\Temp\ksohtml4104\wps2.jpg" alt="img"></p>
<ul>
<li><p>注解配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    配置注解--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    扫描注解所在的包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.bigFunny.ioc&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>@Resource</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;userService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *Resource的name不赋值时相当于<span class="doctag">@Autowired</span>自动导入与变量名相同的属性</span></span><br><span class="line"><span class="comment">     *Resource(&quot;user&quot;)相当于id为userService的bean注入了user属性等于<span class="doctag">@Autowired</span> + <span class="doctag">@Qualifier</span></span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Resource(name = &quot;user&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.user.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="3-Spring-AOP"><a href="#3-Spring-AOP" class="headerlink" title="3.Spring AOP"></a>3.Spring AOP</h1><h2 id="3-1-什么是AOP"><a href="#3-1-什么是AOP" class="headerlink" title="3.1 什么是AOP"></a>3.1 什么是AOP</h2><ul>
<li><p><strong>AOP</strong>的全称是Aspect-Oriented Programming，即<strong>面向切面编程</strong>（也称面向方面编程）。它是面向对象编程（OOP）的一种补充，目前已成为一种比较成熟的编程方式。</p>
</li>
<li><p><strong>AOP</strong>的使用，使开发人员在编写业务逻辑时可以专心于核心业务，而不用过多地关注于其他业务逻辑的实现，这不但提高了开发效率，而且增强了代码的<strong>可维护性</strong>。</p>
</li>
<li><p>目前最流行的AOP框架有两个，分别为<strong>Spring AOP和AspectJ</strong>。Spring AOP使用纯Java实现，不需要专门的编译过程和类加载器，在运行期间通过代理方式向目标类织入增强的代码。</p>
</li>
</ul>
<h3 id="3-1-1-AOP专业术语"><a href="#3-1-1-AOP专业术语" class="headerlink" title="3.1.1 AOP专业术语"></a>3.1.1 AOP专业术语</h3><ul>
<li>这些术语包括<strong>Aspect、Joinpoint、Pointcut、Advice、Target Object、Proxy</strong>和<strong>Weaving</strong>。</li>
</ul>
<h2 id="3-2-动态代理"><a href="#3-2-动态代理" class="headerlink" title="3.2 动态代理"></a>3.2 动态代理</h2><ul>
<li><p>Spring中的AOP代理，可以是JDK动态代理，也可以是CGLIB代理。</p>
<h3 id="3-2-1-JDK动态代理（一定需要实现接口）"><a href="#3-2-1-JDK动态代理（一定需要实现接口）" class="headerlink" title="3.2.1 JDK动态代理（一定需要实现接口）"></a>3.2.1 JDK动态代理（一定需要实现接口）</h3><ul>
<li><p>可以调用<strong>Proxy</strong>类的**newProxyInstance()**方法来创建代理对象。对于使用业务接口的类，Spring默认会使用JDK动态代理来实现AOP。</p>
</li>
<li><p>创造User的实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;添加成功......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;删除成功......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建切面（要增强的功能）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">check_Permissions</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;模拟检查权限....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;模拟记录日志....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建代理对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdkProxy</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="comment">//声明目标类接口</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="comment">//创建代理方法</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">createProxy</span><span class="params">(UserDao userDao)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">        <span class="comment">//1.类加载器</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> JdkProxy.class.getClassLoader();</span><br><span class="line">        <span class="comment">//2.被代理对象实现所有接口</span></span><br><span class="line">        Class&lt;?&gt;[] clazz = userDao.getClass().getInterfaces();</span><br><span class="line">        <span class="comment">//3.使用代理类进行强化，返回代理后对象</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * public static Object newProxyInstance(ClassLoader loader,---本类（代理对象）加载器</span></span><br><span class="line"><span class="comment">         *                                       Class&lt;?&gt;[] interfaces,---被代理对象的所有接口</span></span><br><span class="line"><span class="comment">         *                                       InvocationHandler h)---InvocationHandler，多态</span></span><br><span class="line"><span class="comment">         *         throws IllegalArgumentException</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(classLoader,clazz,<span class="built_in">this</span>);<span class="comment">//this表示当前类</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 所有动态代理对象交给invoke()方法处理</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proxy 被代理对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method 代理对象将要执行的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args 执行的方法需要的参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//1.声明切面</span></span><br><span class="line">        <span class="type">MyAspect</span> <span class="variable">myAspect</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyAspect</span>();</span><br><span class="line">        <span class="comment">//被代理对象（userDao）调用方法前增强的功能</span></span><br><span class="line">        myAspect.check_Permissions();</span><br><span class="line">        <span class="comment">//被代理对象（userDao）调用方法，并传入参数</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> method.invoke(userDao, args);</span><br><span class="line">        <span class="comment">//被代理对象（userDao）调用方法后增强的功能</span></span><br><span class="line">        myAspect.log();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdkTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建代理对象</span></span><br><span class="line">        <span class="type">JdkProxy</span> <span class="variable">jdkProxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdkProxy</span>();</span><br><span class="line">        <span class="comment">//创建目标对象</span></span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">        <span class="comment">//从代理对象中获取增强后的代理目标对象</span></span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">proxyUserDao</span> <span class="operator">=</span> (UserDao) jdkProxy.createProxy(userDao);</span><br><span class="line">        <span class="comment">//执行方法</span></span><br><span class="line">        proxyUserDao.addUser();</span><br><span class="line">        proxyUserDao.deleteUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-2-2-CGLIB动态代理"><a href="#3-2-2-CGLIB动态代理" class="headerlink" title="3.2.2 CGLIB动态代理"></a>3.2.2 CGLIB动态代理</h3><ul>
<li><p>JDK动态代理有一定局限性—–使用动态代理的对象<strong>必须</strong>实现一个或多个接口，如果没有对应实现接口的类进行代理，可以使用<strong>CGLIB</strong>。</p>
</li>
<li><p>CGLIB是一个高性能代码生成包，<strong>Spring</strong>核心包中<strong>集成了CGLIB</strong>所需的包，所以开发中不需另外导包。</p>
</li>
<li><p>CGLIB动态代理实现步骤</p>
</li>
<li><p>1.创建实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建user实体类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;添加成功......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;删除成功......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>2.创建切面（需要增强的功能）</p>
</li>
<li><pre><code class="java">public class MyAspect &#123;
    public void check_Permissions()&#123;
        System.out.println(&quot;模拟检查权限....&quot;);
    &#125;
    public void log()&#123;
        System.out.println(&quot;模拟记录日志....&quot;);
    &#125;
&#125;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 3.创建代理类</span><br><span class="line"></span><br><span class="line">  ```java</span><br><span class="line">  public class CglibProxy implements MethodInterceptor &#123;</span><br><span class="line">      public Object createProxy(Object target)&#123;</span><br><span class="line">          //创建一个动态代理类对象</span><br><span class="line">          Enhancer enhancer = new Enhancer();</span><br><span class="line">          //确定需要增强的类</span><br><span class="line">          enhancer.setSuperclass(target.getClass());</span><br><span class="line">          //添加回调函数</span><br><span class="line">          enhancer.setCallback(this);</span><br><span class="line">          //返回代理类</span><br><span class="line">          return enhancer.create();</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      @Override</span><br><span class="line">      public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable &#123;</span><br><span class="line">          //创建切面对象</span><br><span class="line">          MyAspect myAspect = new MyAspect();</span><br><span class="line">          //增强代理功能</span><br><span class="line">          myAspect.check_Permissions();</span><br><span class="line">          //目标执行方法</span><br><span class="line">          Object o1 = methodProxy.invokeSuper(o, objects);</span><br><span class="line">          //增强代理功能</span><br><span class="line">          myAspect.log();</span><br><span class="line">          return o1;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>4.测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CglibTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建实体类对象</span></span><br><span class="line">        <span class="type">UserDaoImpl</span> <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">        <span class="type">CglibProxy</span> <span class="variable">cglibProxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CglibProxy</span>();</span><br><span class="line">        <span class="type">UserDaoImpl</span> <span class="variable">userDao1</span> <span class="operator">=</span> (UserDaoImpl) cglibProxy.createProxy(userDao);</span><br><span class="line">        userDao1.addUser();</span><br><span class="line">        userDao1.deleteUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="3-3-基于代理类的AOP实现"><a href="#3-3-基于代理类的AOP实现" class="headerlink" title="3.3 基于代理类的AOP实现"></a>3.3 基于代理类的AOP实现</h2><h3 id="3-3-1Spring的通知方式"><a href="#3-3-1Spring的通知方式" class="headerlink" title="3.3.1Spring的通知方式"></a>3.3.1Spring的通知方式</h3><ul>
<li><strong>org.aopalliance.intercept.MethodInterceptor</strong>（环绕通知）在目标方法执行前后实施增强，可以应用于日志、事务管理等功能。</li>
<li><strong>org.springframework.aop.MethodBeforeAdvice</strong>（前置通知）在目标方法执行前实施增强，可以应用于权限管理等功能。</li>
<li><strong>org.springframework.aop.AfterReturningAdvice</strong>（后置通知）在目标方法执行后实施增强，可以应用于关闭流、上传文件、删除临时文件等功能。</li>
<li><strong>org.springframework.aop.ThrowsAdvice</strong>（异常通知）在方法抛出异常后实施增强，可以应用于处理异常记录日志等功能。</li>
<li><strong>org.springframework.aop.IntroductionInterceptor</strong>（引介通知）在目标类中添加一些新的方法和属性，可以应用于修改老版本程序（增强类）。</li>
</ul>
<h3 id="3-3-2-ProxyFactoryBean"><a href="#3-3-2-ProxyFactoryBean" class="headerlink" title="3.3.2 ProxyFactoryBean"></a>3.3.2 ProxyFactoryBean</h3><ul>
<li><p><strong>ProxyFactoryBean</strong>是<strong>FactoryBean</strong>接口的实现类，FactoryBean负责实例化一个Bean，而ProxyFactoryBean负责为其他Bean创建代理实例。</p>
</li>
<li><p><strong>ProxyFactoryBean</strong>类常用属性</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1649947890813.png" alt="1649947890813"></p>
</li>
</ul>
<h3 id="3-3-3-代码实现"><a href="#3-3-3-代码实现" class="headerlink" title="3.3.3 代码实现"></a>3.3.3 代码实现</h3><ul>
<li><p>1.导入aop坐标</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Spring为AOP提供的实现包，Spring的包中已经提供。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--aopalliance-1.0.jar：是AOP联盟提供的规范包--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>aopalliance<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aopalliance<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2.创建切面类MyAspect</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(MethodInvocation methodInvocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        check_Permissions();</span><br><span class="line"><span class="comment">//        执行目标方法</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> methodInvocation.proceed();</span><br><span class="line">        </span><br><span class="line">        log();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">check_Permissions</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;模拟检查权限...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;模拟记录日记...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--1.目标类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itbigFunny.aop.jdk.Impl.UserDaoImpl&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    2.切面类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myAspect&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itbigFunny.aop.factorybean.MyAspect&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    3.使用Spring代理工厂定义一个名称为userDaoProxy的代理对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDaoProxy&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        指定代理实现的接口--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;proxyInterfaces&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.itbigFunny.aop.jdk.UserDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        指定目标对象--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;target&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        指定切面，植入环绕通知--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;interceptorNames&quot;</span> <span class="attr">value</span>=<span class="string">&quot;myAspect&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        指定代理对象方式，ture：使用cglib，false：使用jdk动态代理--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;proxyTargetClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FactoryBeanTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创造容器</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">con</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//从容器中获得代理后对象</span></span><br><span class="line">        <span class="type">UserDaoImpl</span> <span class="variable">userDaoProxy</span> <span class="operator">=</span> (UserDaoImpl) con.getBean(<span class="string">&quot;userDaoProxy&quot;</span>);</span><br><span class="line">        <span class="comment">//调用方法</span></span><br><span class="line">        userDaoProxy.addUser();</span><br><span class="line">        userDaoProxy.deleteUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1649948629607.png" alt="1649948629607"></p>
</li>
</ul>
<h2 id="3-4AspectJ开发"><a href="#3-4AspectJ开发" class="headerlink" title="3.4AspectJ开发"></a>3.4AspectJ开发</h2><ul>
<li><strong>AspectJ</strong>是一个基于Java语言的AOP框架，它提供了强大的AOP功能。使用AspectJ实现AOP有两种方式：<strong>一种是基于XML的声明式AspectJ，另一种是基于注解的声明式AspectJ。</strong></li>
</ul>
<h3 id="3-4-1-基于XML的声明式AspectJ"><a href="#3-4-1-基于XML的声明式AspectJ" class="headerlink" title="3.4.1 基于XML的声明式AspectJ"></a>3.4.1 基于XML的声明式AspectJ</h3><ul>
<li><p>**&lt; aop:config&gt;**的元素及子元素</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1649949031111.png" alt="1649949031111"></p>
</li>
<li><p><strong>配置切面</strong></p>
</li>
<li><p><strong>&lt; aop:aspect&gt;</strong>  将<strong>普通bean对象转为切面对象</strong>，下图为aop:aspect元素的<strong>属性</strong></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1649949211648.png" alt="1649949211648"></p>
</li>
<li><p><strong>切入点 &lt; aop:pointcut&gt;</strong></p>
<p>当&lt; aop:pointcut&gt;为&lt; aop:config&gt;的子元素时，表示为全局切入点，可全局引入</p>
<p>当&lt; aop:pointcut&gt;为&lt; aop:aspect&gt;的子元素时，表示为局部切入点，只可共当前切面使用</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650013627000.png" alt="1650013627000"></p>
<p><strong>execution()说明</strong></p>
<p><img src="/../../../Desktop/img/Snipaste_2022-04-15_17-14-11.png" alt="Snipaste_2022-04-15_17-14-11"></p>
<p><img src="/../../../Desktop/img/1650014795621.png" alt="1650014795621"></p>
</li>
<li><p><strong>配置通知</strong></p>
<p><strong>配置通知有以下属性</strong></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650022359141.png" alt="1650022359141"></p>
</li>
<li><p><strong>代码实现</strong></p>
</li>
<li><p>0.导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring02_AOP<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--导入spring--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--导入aop依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--aopalliance--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>aopalliance<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aopalliance<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--导入AspectJ框架--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>1.实体类实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;添加成功......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;删除成功......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.定义切面类，配置增强的功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myBefore</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置通知：模拟执行权限检擦........&quot;</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;目标类是：&quot;</span> + joinPoint.getTarget());</span><br><span class="line">        System.out.println(<span class="string">&quot;,被植入增强处理目标方法为&quot;</span> + joinPoint.getSignature().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myAfterReturning</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;后置通知：执行记录日志........&quot;</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;目标类是：&quot;</span> + joinPoint.getTarget());</span><br><span class="line">        System.out.println(<span class="string">&quot;,被植入增强处理目标方法为&quot;</span> + joinPoint.getSignature().getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 环绕通知</span></span><br><span class="line"><span class="comment">     * ProceedingJoinPoint是JoinPoint子接口，表示可执行目标方法</span></span><br><span class="line"><span class="comment">     * 1.必须是Object类型返回值</span></span><br><span class="line"><span class="comment">     * 2.必须接受一个参数，类型为ProceedingJoinPoint</span></span><br><span class="line"><span class="comment">     * 3.必须throws Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">myAround</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//开始</span></span><br><span class="line">        System.out.println(<span class="string">&quot;环绕开始：执行目标方法之前，模拟开始事务，..&quot;</span>);</span><br><span class="line">        <span class="comment">//执行当前目标方法</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> proceedingJoinPoint.proceed();</span><br><span class="line">        <span class="comment">//结束</span></span><br><span class="line">        System.out.println(<span class="string">&quot;坏绕结束：执行目标方法之后，模拟关闭事务&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//异常通知</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myAfterThrowing</span><span class="params">(JoinPoint joinPoint,Throwable e)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;异常通知：&quot;</span> + <span class="string">&quot;出错了&quot;</span> + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//最终通知</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myAfter</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;最终通知：模拟方法结束后释放资源.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.aop的xml配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--0，定义目标类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itbigFunny.aop.jdk.Impl.UserDaoImpl&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    定义切面bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myAspect&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itbigFunny.aop.aspect.xml.MyAspect&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        1.配置切面，将普通bean转为切面--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;aspect&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;myAspect&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--        2.配置切入点：jdk包下所有类的所有方法--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;myPointcut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.itbigFunny.aop.jdk.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--        3.配置通知--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            关联通知Advice和切入点pointCut--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--前置通知--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;myBefore&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--后置通知,在方法返回之后执行，就可以获得返回值</span></span><br><span class="line"><span class="comment">            returning属性：用于设置后置通知的第二个参数的名称，类型是Object--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;myAfterReturning&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut&quot;</span> <span class="attr">returning</span>=<span class="string">&quot;returnVal&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--环绕通知--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;myAround&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--异常通知--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;myAfterThrowing&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut&quot;</span> <span class="attr">throwing</span>=<span class="string">&quot;e&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--最终通知--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;myAfter&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>后置通知</strong>与<strong>最终通知</strong>都是在方法<strong>执行后</strong>通知切面执行方法，区别在于<strong>后置通知</strong>必须要在目标方法<strong>不报错</strong>的情况下才能执行，而<strong>最终通知</strong>无论报不报错都执行。</p>
</li>
<li><p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestXmlAspect</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">con</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserDaoImpl</span> <span class="variable">userDao</span> <span class="operator">=</span> (UserDaoImpl) con.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">        userDao.addUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650027774178.png" alt="1650027774178"></p>
</li>
<li><p>将add返回10&#x2F;0制造异常，测试异常通知</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;添加成功......&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650028108043.png" alt="1650028108043"></p>
<p>由图也可看出<strong>后置通知</strong>与<strong>最终通知</strong>的区别</p>
</li>
</ul>
<h3 id="3-4-2-基于注解的声明式AspectJ"><a href="#3-4-2-基于注解的声明式AspectJ" class="headerlink" title="3.4.2 基于注解的声明式AspectJ"></a>3.4.2 基于注解的声明式AspectJ</h3><p><strong>基于XML的声明式AspectJ</strong>会产生大量的配置信息，造成代码的臃肿，为了解决这类问题Spring提供了<strong>注解</strong>方式实现<strong>AOP</strong>。</p>
<ul>
<li><p><strong>AspectJ的注解及其描述</strong></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650028894045.png" alt="1650028894045"></p>
</li>
<li><p><strong>代码实现</strong></p>
</li>
<li><p>1.创建目标类给目标类加个注解@Repository(“userDao”)，导坐标</p>
</li>
<li><p>2.注解方式创建切面类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *定义切面类，在此类中书写</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect</span> &#123;</span><br><span class="line">    <span class="comment">//定义切入点表达式</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.itbigFunny.aop.jdk.*.*(..))&quot;)</span></span><br><span class="line">    <span class="comment">//使用一个返回值为空，方法体为空的方法为切入点</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">myPointCut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="comment">//定义通知</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//前置通知</span></span><br><span class="line">    <span class="meta">@Before(&quot;myPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myBefore</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置通知：模拟执行权限检擦........&quot;</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;目标类是：&quot;</span> + joinPoint.getTarget());</span><br><span class="line">        System.out.println(<span class="string">&quot;,被植入增强处理目标方法为&quot;</span> + joinPoint.getSignature().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//后置通知</span></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;myPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myAfterReturning</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;后置通知：执行记录日志........&quot;</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;目标类是：&quot;</span> + joinPoint.getTarget());</span><br><span class="line">        System.out.println(<span class="string">&quot;,被植入增强处理目标方法为&quot;</span> + joinPoint.getSignature().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 环绕通知</span></span><br><span class="line"><span class="comment">     * ProceedingJoinPoint是JoinPoint子接口，表示可执行目标方法</span></span><br><span class="line"><span class="comment">     * 1.必须是Object类型返回值</span></span><br><span class="line"><span class="comment">     * 2.必须接受一个参数，类型为ProceedingJoinPoint</span></span><br><span class="line"><span class="comment">     * 3.必须throws Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around(&quot;myPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">myAround</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//开始</span></span><br><span class="line">        System.out.println(<span class="string">&quot;环绕开始：执行目标方法之前，模拟开始事务，..&quot;</span>);</span><br><span class="line">        <span class="comment">//执行当前目标方法</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> proceedingJoinPoint.proceed();</span><br><span class="line">        <span class="comment">//结束</span></span><br><span class="line">        System.out.println(<span class="string">&quot;坏绕结束：执行目标方法之后，模拟关闭事务&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//异常通知</span></span><br><span class="line">    <span class="meta">@AfterThrowing(value = &quot;myPointCut()&quot;,throwing = &quot;e&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myAfterThrowing</span><span class="params">(JoinPoint joinPoint,Throwable e)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;异常通知：&quot;</span> + <span class="string">&quot;出错了&quot;</span> + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//最终通知</span></span><br><span class="line">    <span class="meta">@After(&quot;myPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myAfter</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;最终通知：模拟方法结束后释放资源.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.配置扫描注解，声明AspectJ</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    扫描注解--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itbigFunny.aop&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    启动基于注解声明式Aspect--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>4.测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestXmlAspect</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">con</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> (UserDao) con.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">        userDao.addUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650030835565.png" alt="1650030835565"></p>
<p><strong>注意</strong></p>
<p>​		如果在<strong>同一个连接点</strong>有<strong>多个通知</strong>需要执行，那么在<strong>同一切面</strong>中，目标方法之前的<strong>前置通知和环绕通知的执行顺序是未知的</strong>，目标方法之后的<strong>后置通知</strong>和<strong>环绕通知</strong>的执行顺序也是<strong>未知的</strong>。</p>
<h3 id="3-5-AOP知识总结"><a href="#3-5-AOP知识总结" class="headerlink" title="3.5 AOP知识总结"></a>3.5 AOP知识总结</h3><p>​		<strong>面向切面编程</strong>，和面向对象不一样，<strong>面向对象</strong>是<strong>从类出发</strong>；而<strong>面向切面</strong>是从对象的<strong>方法出发</strong>，将<strong>对象方法看作类的组件</strong>，<strong>aop</strong>关注的就是这些组件，可以类比理解Vue的设计，将页面拆分成多个组件的思想。我对它还有个更直白的理解：<strong>aop编程就是在目标方法执行前后做某些事，比如在执行前开启事务，在执行后提交或回滚事务。</strong></p>
<ul>
<li><p><strong>切面(Aspect):</strong> 切入目标业务方法前后的独立完整模块</p>
</li>
<li><p>**连接点(Join point):**具体切入的位置，即符合匹配条件的目标业务方法</p>
</li>
<li><p>**切入点(Point Cut):**切入点，定义匹配条件。</p>
</li>
<li><p>**通知(Advice):**切面的具体实现方法。</p>
<ul>
<li>**前置通知(Before):**在目标业务方法执行前执行。</li>
<li>**环绕通知(Around):**在目标业务方法执行前后都会执行。</li>
<li>**后置通知(AfterReturning):**在目标业务方法正常执行后并且没有抛出异常执行。</li>
<li>**异常通知(AfterThrowing):**在目标业务方法执行抛出异常时执行。</li>
<li>**最终通知(After):**在目标业务方法执行后，不论是否正常执行完，最终通知都会执行。</li>
</ul>
</li>
<li><p><strong>通知执行顺序</strong></p>
<p><strong>Around-&gt;Before-&gt;Around-&gt;After-&gt;AfterReturning</strong></p>
</li>
<li><p><strong>切入点的相关细节</strong></p>
<ul>
<li><strong>jointpoint:<strong>程序运行过程中可识别的点，这个点可以用来作为<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=AOP&spm=1001.2101.3001.7020">AOP</a>切入点，通过</strong>JpointPoint</strong>对象可以获取到下面信息。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 返回目标对象，即被代理的对象</span><br><span class="line">Object <span class="title function_">getTarget</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"># 返回切入点的参数</span><br><span class="line">Object[] getArgs();</span><br><span class="line"></span><br><span class="line"># 返回切入点的Signature</span><br><span class="line">Signature <span class="title function_">getSignature</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"># 返回切入的类型，比如method-call，field-get等等，感觉不重要 </span><br><span class="line"> String <span class="title function_">getKind</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><h4 id="ProceedingJoinPoint：继承了-JoinPoint，是在JoinPoint的基础上暴露出-proceed-这个方法。"><a href="#ProceedingJoinPoint：继承了-JoinPoint，是在JoinPoint的基础上暴露出-proceed-这个方法。" class="headerlink" title="ProceedingJoinPoint：继承了 JoinPoint，是在JoinPoint的基础上暴露出 proceed 这个方法。"></a><strong>ProceedingJoinPoint：</strong>继承了 JoinPoint，是在JoinPoint的基础上暴露出 proceed 这个方法。</h4><p>​		<strong>环绕通知&#x3D;前置+目标方法执行+后置通知，proceed方法就是用于启动目标方法执行的</strong></p>
<p>​		暴露出这个方法，就能支持 <strong>aop:around</strong> 这种切面（而其他的几种切面只需要用到<strong>JoinPoint</strong>，，这也是环绕通知和前置、后置通知方法的一个最大区别。这跟切面类型有关）， 能决定是否走<strong>代理链</strong>还是走<strong>自己拦截的其他逻辑</strong>。建议看一下 JdkDynamicAopProxy的invoke方法，了解一下代理链的执行原理。</p>
</li>
<li><p><strong>pointcut:<strong>是一种程序结构和规则，它用于选取</strong>joinpoin</strong>t并收集这些<strong>poin</strong>t的上下文信息，可以把<strong>Pointcut</strong>当做<strong>jointpoint</strong>的集合。</p>
</li>
</ul>
</li>
<li><p><strong>AOP代理方式</strong></p>
<ul>
<li><p><strong>JDK代理方式</strong>(必须传入接口)</p>
</li>
<li><p><strong>JGLIB代理方式</strong>(传入接口和对象都行)</p>
</li>
<li><p><strong>切换方式</strong>（默认为false即JDK代理方式）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    使用CGLIB代理方式--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h1 id="4-Spring数据库开发"><a href="#4-Spring数据库开发" class="headerlink" title="4.Spring数据库开发"></a>4.Spring数据库开发</h1><h3 id="4-1-Spring-JDBC"><a href="#4-1-Spring-JDBC" class="headerlink" title="4.1 Spring   JDBC"></a>4.1 Spring   JDBC</h3><p><strong>4.1.1 Spring JdbcTemplate类</strong></p>
<ul>
<li><strong>类关系图</strong></li>
</ul>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650114296959.png" alt="1650114296959"></p>
<ul>
<li><p><strong>公共属性</strong></p>
<ul>
<li><p><strong>DataSource：</strong>其主要功能是<strong>获取数据库连接</strong>，具体实现时还可以引入对数据库连接的缓冲池和分布式事务的支持，它可以<strong>作为访问数据库资源的标准接口</strong>。</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650116660459.png" alt="1650116660459"></p>
</li>
<li><p><strong>SQLExceptionTranslator：</strong>负责对SQLException进行转译工作。</p>
</li>
<li><p><strong>JdbcOperations：</strong>定义了在JdbcTemplate类中可以使用的操作集合，包括添加、修改、查询和删除等操作。</p>
</li>
</ul>
</li>
<li><p><strong>配置</strong></p>
<ul>
<li><p>Spring JDBC模块主要由4个包组成，分别是core（核心包）、dataSource（数据源包）、object（对象包）和support（支持包）。</p>
</li>
<li><p><strong>模块介绍：</strong></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650114899488.png" alt="1650114899488"></p>
</li>
<li><p><strong>导入坐标</strong></p>
</li>
<li><p>&#96;&#96;&#96;xml</p>
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <version>8.0.16</version>
</dependency>
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-jdbc</artifactId>
    <version>5.3.18</version>
</dependency>
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-tx</artifactId>
    <version>5.3.18</version>
</dependency>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- spring配置</span><br><span class="line"></span><br><span class="line">- ```xml</span><br><span class="line">  &lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;</span><br><span class="line">              &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">              &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://127.0.0.1:3306/dbl2?serverTimezone=GMT%2B8&amp;amp;useSSL=false&amp;amp;useServerPrepStmts=true&quot;/&gt;</span><br><span class="line">              &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">              &lt;property name=&quot;password&quot; value=&quot;0614&quot;/&gt;</span><br><span class="line">          &lt;/bean&gt;</span><br><span class="line">  &lt;!--    配置JDBCTemplate模板--&gt;</span><br><span class="line">          &lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;</span><br><span class="line">  &lt;!--            默认使用数据源--&gt;</span><br><span class="line">              &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;</span><br><span class="line">          &lt;/bean&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h1 id="5-Spring的事务管理"><a href="#5-Spring的事务管理" class="headerlink" title="5.Spring的事务管理"></a>5.Spring的事务管理</h1><p>学习目标</p>
<p>● 熟悉Spring事务管理的3个核心接口</p>
<p>● 了解Spring事务管理的两种方式</p>
<p>● 掌握基于XML和Annotation的声明式事务的使用</p>
<h2 id="5-1事务管理概述"><a href="#5-1事务管理概述" class="headerlink" title="5.1事务管理概述"></a>5.1事务管理概述</h2><ul>
<li><p><strong>spring-tx-4.3.6.RELEASE</strong>的JAR包：该包就是Spring提供的用于事务管理的依赖包。</p>
</li>
<li><p><strong>org.springframework.transaction包：</strong>我们可以找到3个接口文件<strong>PlatformTransactionManager</strong>、<strong>TransactionDefinition</strong>和<strong>TransactionStatus</strong></p>
<ul>
<li><p><strong>PlatformTransactionManager接口</strong>：用于管理事务，其下有3个方法</p>
<ul>
<li><p><strong>TransactionStatus getTransaction（TransactionDefinition definition）</strong>：用于获取事务状态信息。</p>
</li>
<li><p><strong>void commit（TransactionStatus status）</strong>：用于提交事务。</p>
</li>
<li><p><strong>void rollback（TransactionStatus status）</strong>：用于回滚事务。</p>
<ul>
<li><strong>PlatformTransactionManager接口</strong>有许多不同的实现类，常见的几个实现类如下。</li>
</ul>
</li>
<li><p><strong>· org.springframework.jdbc.datasource.DataSourceTransactionManager：</strong>用于<strong>配置JDBC数据源</strong>的事务管理器。</p>
</li>
<li><p><strong>· org.springframework.orm.hibernate4.HibernateTransactionManager：</strong>用于<strong>配置Hibernate的事务管理器。</strong></p>
</li>
<li><p><strong>· org.springframework.transaction.jta.JtaTransactionManager：</strong>用于配置<strong>全局事务管理器。</strong></p>
</li>
<li><p>当底层采用不同的持久层技术时，系统只需使用不同的<strong>PlatformTransactionManager</strong>实现类即可。</p>
</li>
</ul>
</li>
<li><p><strong>TransactionDefinition</strong>：事务定义（描述）的对象，该对象中定义了事务规则，并提供了获取事务相关信息的方法，具体如下。</p>
<ul>
<li><strong>String getName()：</strong>获取事务对象名称。</li>
<li><strong>int getIsolationLevel()：</strong>获取事务的隔离级别。</li>
<li><strong>int getPropagationBehavior()：</strong>获取事务的传播行为。<ul>
<li>事务的<strong>传播行为</strong>是指在同一个方法中，不同操作前后所使用的事务，下图为事务传播行为的种类。</li>
<li><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650175561851.png" alt="1650175561851"></li>
</ul>
</li>
<li><strong>int getTimeout()：</strong>获取事务的超时时间。</li>
<li><strong>boolean isReadOnly()：</strong>获取事务是否只读。</li>
</ul>
</li>
<li><p><strong>TransactionStatus</strong>：事务的状态，有以下几个方法。</p>
<ul>
<li><strong>· void flush()：</strong>刷新事务。</li>
<li><strong>· boolean hasSavepoint()：</strong>获取是否存在保存点。</li>
<li><strong>· boolean isCompleted()：</strong>获取事务是否完成。</li>
<li><strong>· boolean isNewTransaction()：</strong>获取是否是新事务。</li>
<li><strong>· boolean isRollbackOnly()：</strong>获取是否回滚。</li>
<li><strong>· void setRollbackOnly()：</strong>设置事务回滚。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="5-2-事务的管理方式"><a href="#5-2-事务的管理方式" class="headerlink" title="5.2 事务的管理方式"></a>5.2 事务的管理方式</h2><p>Spring中的事务管理分为两种方式：一种是传统的<strong>编程式事务管理</strong>，另一种是<strong>声明式事务管理</strong>。</p>
<ul>
<li><strong>编程式事务管理</strong>：是通过编写代码实现的事务管理，包括定义事务的开始、正常执行后的事务提交和异常时的事务回滚。</li>
<li><strong>声明式事务管理</strong>：是通过<strong>AOP技术</strong>实现的事务管理，其主要思想是将<strong>事务管理</strong>作为一个<strong>“切面”</strong>代码<strong>单独</strong>编写，然后通过<strong>AOP技术</strong>将事务管理的<strong>“切面”代码</strong>织入到<strong>业务目标类</strong>中。</li>
</ul>
<h2 id="5-3-声明式事务管理"><a href="#5-3-声明式事务管理" class="headerlink" title="5.3 声明式事务管理"></a>5.3 声明式事务管理</h2><p>Spring的声明式事务管理可以通过两种方式来实现，一种是<strong>基于XML的方式</strong>，另一种是<strong>基于Annotation的方式</strong>。</p>
<ul>
<li><p><strong>基于XML方式的声明式事务</strong></p>
<ul>
<li><p><tx-advice>介绍</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650194659312.png" alt="1650194659312"></p>
</li>
<li></li>
</ul>
</li>
<li><p><strong>基于Annotation方式的声明式事务</strong></p>
</li>
<li><p><strong>@Transactional</strong></p>
</li>
</ul>
<h1 id="6-初始Mybatis"><a href="#6-初始Mybatis" class="headerlink" title="6.初始Mybatis"></a>6.初始Mybatis</h1><p><strong>学习目标</strong></p>
<p>● 了解MyBatis的基础知识</p>
<p>● 熟悉MyBatis的工作原理</p>
<p>● 掌握MyBatis入门程序的编写</p>
<h2 id="6-1-MyBatis的基础知识"><a href="#6-1-MyBatis的基础知识" class="headerlink" title="6.1 MyBatis的基础知识"></a>6.1 MyBatis的基础知识</h2><ul>
<li><p><strong>MyBatis（前身是iBatis）:<strong>使用简单的</strong>XML</strong>或<strong>注解</strong>进行<strong>配置</strong>和<strong>原始映射</strong>，用以将<strong>接口</strong>和<strong>Java的POJO</strong>（PlainOld Java Object，普通Java对象）<strong>映射成数据库</strong>中的<strong>记录</strong>，使得Java开发人员可以使用面向对象的编程思想来操作数据库。</p>
</li>
<li><p><strong>人话：将pojo映射到数据库中的记录</strong></p>
</li>
<li><p><strong>MyBatis框架也被称之为ORM：</strong>ORM就是一种为了解决<strong>面向对象</strong>与<strong>关系型数据库</strong>中<strong>数据类型不匹配</strong>的技术，它通过描述<strong>Java对象</strong>与<strong>数据库表</strong>之间的映射关系，<strong>自动</strong>将Java应用程序中的<strong>对象</strong>持久化到<strong>关系型数据库的表</strong>中。</p>
<ul>
<li><p><strong>ORM框架的工作原理</strong></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650199642148.png" alt="1650199642148"></p>
</li>
<li><p>用<strong>ORM</strong>框架后，应用程序不再直接访问<strong>底层数据库</strong>，而是以<strong>面向对象</strong>的方式来<strong>操作持久化对象</strong>（Persisent Object, PO），而<strong>ORM框架</strong>则会<strong>通过映射关系</strong>将这些<strong>面向对象的操作</strong>转换成<strong>底层的SQL操作</strong>。</p>
</li>
</ul>
</li>
<li><p><strong>常见的两种ORM框架</strong></p>
<ul>
<li><strong>Hibernate：</strong>是一个<strong>全表映射的框架</strong>。通常开发者只需定义好持久化对象到数据库表的映射关系，就可以通过Hibernate提供的方法完成持久层操作。开发者并<strong>不需要熟练地掌握SQL语句</strong>的编写，Hibernate会根据制定的存储逻辑，<strong>自动的生成对应的SQL，并调用JDBC接口来执行，所以其开发效率会高于MyBatis</strong>。<strong>然而</strong>Hibernate自身也存在着一些<strong>缺点</strong>，例如<strong>它在多表关联时，对SQL查询的支持较差</strong>；<strong>更新数据时，需要发送所有字段</strong>；<strong>不支持存储过程</strong>；<strong>不能通过优化SQL来优化性能等</strong>。这些问题导致其只适合在场景<strong>不太复杂</strong>且对<strong>性能要求不高</strong>的项目中使用。</li>
<li><strong>MyBatis：</strong>是一个<strong>半自动映射的框架</strong>。这里所谓的“半自动”是相对于Hibernate全表映射而言的，<strong>MyBatis</strong>需要<strong>手动匹配提供POJO、SQL和映射关系</strong>，而<strong>Hibernate只需提供POJO和映射关系即可</strong>。与Hibernate相比，虽然使用MyBatis手动编写SQL要比使用Hibernate的工作量大，但<strong>MyBatis可以配置动态SQL并优化SQL</strong>，可以<strong>通过配置决定SQL的映射规则，它还支持存储过程等</strong>。对于<strong>一些复杂的和需要优化性能</strong>的项目来说，显然使用MyBatis更加合适。</li>
</ul>
</li>
</ul>
<h2 id="6-2-MyBatis的工作原理"><a href="#6-2-MyBatis的工作原理" class="headerlink" title="6.2 MyBatis的工作原理"></a>6.2 MyBatis的工作原理</h2><ul>
<li><strong>MyBatis框架执行流程</strong><ul>
<li><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650200462005.png" alt="1650200462005"></li>
<li>（1）<strong>读取MyBatis配置文件mybatis-config.xml。</strong> <strong>mybatis-config.xml</strong>作为<strong>MyBatis</strong>的全局配置文件，配置了MyBatis的运行环境等信息，其中<strong>主要内容是获取数据库连接</strong>。</li>
<li>（2）<strong>加载映射文件Mapper.xml。</strong>Mapper.xml文件即<strong>SQL映射文件</strong>，该文件中配置了<strong>操作数据库的SQL语句</strong>，需要在<strong>mybatis-config.xml</strong>中加载才能执行。mybatis-config.xml可以加载多个配置文件，每个配置文件对应数据库中的一张表。</li>
<li>（3）<strong>构建会话工厂。</strong>通过MyBatis的环境等配置信息<strong>构建会话工厂SqlSessionFactory</strong>。</li>
<li>（4）<strong>创建SqlSession对象。</strong>由会话工厂创建SqlSession对象，该对象中<strong>包含了执行SQL的所有方法</strong>。</li>
<li>（5）<strong>MyBatis底层定义了一个Executor接口来操作数据库，它会根据SqlSession传递的参数动态地生成需要执行的SQL语句，同时负责查询缓存的维护。</strong></li>
<li>（6）在<strong>Executor接口</strong>的执行方法中，包含一个<strong>MappedStatement类型的参数</strong>，该参数是对映射信息的<strong>封装</strong>，用于<strong>存储要映射的SQL语句的id、参数等</strong>。<strong>Mapper.xml</strong>文件中一个<strong>SQL</strong>对应一个<strong>MappedStatement</strong>对象，<strong>SQL的id即是MappedStatement的id。</strong></li>
<li>（7）<strong>输入参数映射。</strong>在执行方法时，<strong>MappedStatement</strong>对象会对<strong>用户执行SQL语句</strong>的<strong>输入参数</strong>进行定义<strong>（可以定义为Map、List类型、基本类型和POJO类型）</strong>,Executor执行器会通过MappedStatement对象在执行SQL前，将<strong>输入的Java对象映射到SQL语句</strong>中。这里对<strong>输入参数的映射过程</strong>就类似于<strong>JDBC编程中对preparedStatement对象设置参数</strong>的过程。</li>
<li>（8）<strong>输出结果映射。</strong>在数据库中<strong>执行完SQL语句</strong>后，<strong>MappedStatement</strong>对象会对SQL执行输出的结果进行定义（可以定义为Map和List类型、基本类型、POJO类型）, Executor执行器会通过MappedStatement对象在执行SQL语句后，将<strong>输出结果映射至Java对象</strong>中。这种将<strong>输出结果映射到Java对象的过程</strong>就类似于<strong>JDBC编程中对结果的解析处理</strong>过程。</li>
</ul>
</li>
</ul>
<h2 id="6-3-第一个MyBatis程序"><a href="#6-3-第一个MyBatis程序" class="headerlink" title="6.3 第一个MyBatis程序"></a>6.3 第一个MyBatis程序</h2><ul>
<li><p><strong>1.导入坐标</strong></p>
<ul>
<li>&#96;&#96;&#96;xml<!--        mysql连接包-->
<pre><code>    &lt;dependency&gt;
        &lt;groupId&gt;mysql&lt;/groupId&gt;
        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;version&gt;8.0.16&lt;/version&gt;
    &lt;/dependency&gt;
</code></pre>
<!--        mybatis框架-->
<pre><code>    &lt;dependency&gt;
        &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
        &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
        &lt;version&gt;3.5.5&lt;/version&gt;
    &lt;/dependency&gt;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- **2.配置log4j日志信息**</span><br><span class="line"></span><br><span class="line">  - ```properties</span><br><span class="line">    log4j.rootLogger=ERROR,stdout</span><br><span class="line">    log4j.logger.com.itzjc=DEBUG</span><br><span class="line">    log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span><br><span class="line">    log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</span><br><span class="line">    log4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>3.创造核心配置文件</strong></p>
<ul>
<li>&#96;&#96;&#96;xml<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <!-- 起别名 -->
    <typeAliases>
        <package name="com.itzjc.pojo"/>
    </typeAliases>
    <!-- environments:配置数据库的连接环境信息，可复制多个environments，通过default切换不同环境-->
    <environments default="mysql">
        <environment id="mysql">
            <transactionManager type="JDBC"/>
            <!--            dataSource type：数据库连接池-->
            <dataSource type="POOLED">
                <!--数据库连接信息-->
                <property name="driver" value="com.mysql.cj.jdbc.Driver"/>
                <property name="url" value="jdbc:mysql://127.0.0.1:3306/dbl2?serverTimezone=GMT%2B8"/>
                <property name="username" value="root"/>
                <property name="password" value="0614"/>
            </dataSource>
        </environment>
    </environments>
    <mappers>
        <!--加载sql映射文件-->
        <!--        <mapper resource="com/itzjc/mapper/UserMapper.xml"/>-->
        <!--包扫描-->
        <package name="com.itzjc.mapper"/>
    </mappers>
</configuration>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- **4.定义pojo类映射数据库相应的表**</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    public class Brand &#123;</span><br><span class="line">        private int id;</span><br><span class="line">        private String brandName;</span><br><span class="line">        private String companyName;</span><br><span class="line">        private int ordered;</span><br><span class="line">        private String description;</span><br><span class="line">        private byte status;</span><br><span class="line">    </span><br><span class="line">        public int getId() &#123;</span><br><span class="line">            return id;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public void setId(int id) &#123;</span><br><span class="line">            this.id = id;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public String getBrandName() &#123;</span><br><span class="line">            return brandName;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public void setBrandName(String brandName) &#123;</span><br><span class="line">            this.brandName = brandName;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public String getCompanyName() &#123;</span><br><span class="line">            return companyName;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public void setCompanyName(String companyName) &#123;</span><br><span class="line">            this.companyName = companyName;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public int getOrdered() &#123;</span><br><span class="line">            return ordered;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public void setOrdered(int ordered) &#123;</span><br><span class="line">            this.ordered = ordered;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public String getDescription() &#123;</span><br><span class="line">            return description;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public void setDescription(String description) &#123;</span><br><span class="line">            this.description = description;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public byte getStatus() &#123;</span><br><span class="line">            return status;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public void setStatus(byte status) &#123;</span><br><span class="line">            this.status = status;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        @Override</span><br><span class="line">        public String toString() &#123;</span><br><span class="line">            return &quot;Brand&#123;&quot; +</span><br><span class="line">                    &quot;id=&quot; + id +</span><br><span class="line">                    &quot;, brandName=&#x27;&quot; + brandName + &#x27;\&#x27;&#x27; +</span><br><span class="line">                    &quot;, companyName=&#x27;&quot; + companyName + &#x27;\&#x27;&#x27; +</span><br><span class="line">                    &quot;, ordered=&quot; + ordered +</span><br><span class="line">                    &quot;, description=&#x27;&quot; + description + &#x27;\&#x27;&#x27; +</span><br><span class="line">                    &quot;, status=&quot; + status +</span><br><span class="line">                    &#x27;&#125;&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>5.创建sql映射文件</strong></p>
<ul>
<li>&#96;&#96;&#96;xml<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--namespace表示命名空间，“包名+SQL映射文件名”-->
<mapper namespace="com.itzjc.mapper.BrandMapper">
<!-- mapper子元素<select>中的信息是用于执行查询操作的配置-->
    <!-- parameterType属性用于指定传入参数的类型-->
    <!-- resultType属性用于指定返回结果的类型-->
    <select id="selectById" resultType="com.itzjc.pojo.Brand" parameterType="integer">
            select * from tb_brand where id = #{id};
    </select>
</mapper>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- **6.创建sql映射文件接口**</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    public interface BrandMapper &#123;</span><br><span class="line">        Brand selectById(int id);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>7.测试</strong></p>
<ul>
<li>&#96;&#96;&#96;java<br>public class BrandTest {<br>@Test<br>public void FindTest() throws IOException {<br>&#x2F;&#x2F;        1.读取配置信息<br>    InputStream resource &#x3D; Resources.getResourceAsStream(“mybatis_config.xml”);<br>&#x2F;&#x2F;        2.构造SqlSessionFactory对象<br>    SqlSessionFactory factory &#x3D; new SqlSessionFactoryBuilder().build(resource);<br>&#x2F;&#x2F;        3.创建sqlSession对象<br>    SqlSession sqlSession &#x3D; factory.openSession();<br>&#x2F;&#x2F;        4.从sqlSession获得映射对象，并执行映射对象映射的sql，并返回映射结果<br>    BrandMapper mapper &#x3D; sqlSession.getMapper(BrandMapper.class);<br>    Brand brand &#x3D; mapper.selectById(1);<br>&#x2F;&#x2F;        5.打印<br>    System.out.println(brand);<br>&#x2F;&#x2F;        6.关闭sqlSession，释放资源<br>    sqlSession.close();<br>}<br>}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 7.MyBatis核心配置文件</span><br><span class="line"></span><br><span class="line">**学习目标**</span><br><span class="line"></span><br><span class="line">● 了解MyBatis核心对象的作用</span><br><span class="line"></span><br><span class="line">● 熟悉MyBatis配置文件中各个元素的作用</span><br><span class="line"></span><br><span class="line">● 掌握MyBatis映射文件中常用元素的使用</span><br><span class="line"></span><br><span class="line">## 7.1 MyBatis核心对象</span><br><span class="line"></span><br><span class="line">两个**核心对象**：**SqlSessionFactory**和**SqlSession**</span><br><span class="line"></span><br><span class="line">**持久层：**可以理解成**数据**保存在**数据库**或者**硬盘**一类可以保存很长时间的设备里面，不像放在内存中那样断电就消失了，也就是把**数据**存在**持久化设备**上，**mybatis**就是持久层。</span><br><span class="line"></span><br><span class="line">- **SqlSessionFactory：**单个数据库映射关系经过编译后的**内存镜像**，是SqlSession对象工厂，可由**SqlSessionFactoryBuilder**对象创建。</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    //        1.读取配置信息</span><br><span class="line">            InputStream resource = Resources.getResourceAsStream(&quot;mybatis_config.xml&quot;);</span><br><span class="line">    //        2.构造SqlSessionFactory对象</span><br><span class="line">            SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(resource);</span><br></pre></td></tr></table></figure>

<strong>SqlSessionFactory对象</strong>是线程安全的，它一旦被创建，在<strong>整个应用执行期间</strong>都会存在。如果我们<strong>多次</strong>地创建同一个<strong>数据库</strong>的<strong>SqlSessionFactory</strong>，那么此<strong>数据库的资源</strong>将很容易被<strong>耗尽</strong>。为了解决此问题，通常<strong>每一个数据库</strong>都会只对应一个<strong>SqlSessionFactory</strong>，所以在构建<strong>SqlSessionFactory</strong>实例时，建议使用<strong>单列模式。</strong></li>
</ul>
</li>
<li><p><strong>SqlSession</strong>：主要作用是执行<strong>持久化操作</strong>，线程不安全，<strong>SqlSession</strong>对象包含了数据库中所有执行SQL操作的方法，由于其底层封装了JDBC连接，所以可以直接使用其实例来执行已映射的SQL语句。</p>
<ul>
<li><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650209558822.png" alt="1650209558822"></li>
<li>Sqlsession有很多sql方法，和事务方法，<T> T getMapper(Class<T> type)；可以获得关联sqlsession的Mapper接口代理对象，Connection getConnection()；获得jdbc数据库连接0</li>
<li>工具类获得sqlsession</li>
<li><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650210275690.png" alt="1650210275690"></li>
</ul>
</li>
</ul>
<h2 id="7-2-配置文件的元素"><a href="#7-2-配置文件的元素" class="headerlink" title="7.2 配置文件的元素"></a>7.2 配置文件的元素</h2><ul>
<li><p>主要元素图表</p>
<ul>
<li><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650210428139.png" alt="1650210428139"></li>
<li><strong>注意</strong>：配置的时候必须按图中从上向下配置</li>
</ul>
</li>
<li><p><strong><properties>元素：</strong>是一个配置属性的元素，<strong>用于连接外部属性表</strong>。</p>
</li>
<li><p><strong><settings>元素：</strong>主要用于改变MyBatis运行时的行为，例如开启二级缓存、开启延迟加载等。</p>
<ul>
<li>常见配置</li>
<li><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650210873024.png" alt="1650210873024"></li>
</ul>
</li>
<li><p><strong><typeAliases>元素：</strong>设置别名。</p>
<ul>
<li><p><strong>单个类别名设置</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;brand&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.itzjc.pojo.Brand&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>表示可以用brand来表示com.itzjc.pojo.Brand这个类，如果alias没写，则默认为brand。</p>
</li>
<li><p><strong>单个类注解</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Alias(&quot;brand&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Brand</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>多个类别名设置</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.itzjc.pojo&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>首字母小写的非限定类名来作为它的别名，例如，brand。</p>
<p><strong>注意：</strong>上述方式的别名只适用于没有使用注解的情况，如果在程序中使用了注解，则别名为其注解的值。</p>
</li>
<li><p><strong>默认别名</strong></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650211795207.png" alt="1650211795207"></p>
</li>
</ul>
</li>
<li><p><strong><typeHandler>元素：</strong>将预处理语句中传入的参数从<strong>javaType（Java类型）</strong>转换为<strong>jdbcType（JDBC类型）</strong>，或者从数据库取出结果时将<strong>jdbcType</strong>转换为<strong>javaType</strong>。</p>
<ul>
<li><p>默认类型处理器</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650212147905.png" alt="1650212147905"></p>
</li>
<li><p>自定义类型处理器</p>
<ul>
<li><p>单个类的类型处理器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;com.itzjc.pojo.Brand&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>整个包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.itzjc.pojo&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p><strong><objectFactory>元素</strong>：<strong>实例化目标类</strong>，它既可以通过默认构造方法实例化，也可以在参数映射存在的时候通过参数构造方法来实例化。</p>
<ul>
<li><p>覆盖默认行为</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650265886766.png" alt="1650265886766"></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650265919856.png" alt="1650265919856"></p>
</li>
</ul>
</li>
<li><p><strong><plugins>元素：</strong>配置用户所开发的插件。</p>
</li>
<li><p><strong><environments>元素：</strong>通过<environments>元素配置<strong>多种数据源</strong>，即配置<strong>多种数据库</strong>。</p>
<ul>
<li>&#96;&#96;&#96;xml<!-- environments:配置数据库的连接环境信息，可复制多个environments，通过default切换不同环境-->
<environments default="mysql">
    <environment id="mysql">
        <transactionManager type="JDBC"/>
        <!--            dataSource type：数据库连接池-->
        <dataSource type="POOLED">
            <!--数据库连接信息-->
            <property name="driver" value="com.mysql.cj.jdbc.Driver"/>
            <property name="url" value="jdbc:mysql://127.0.0.1:3306/dbl2?serverTimezone=GMT%2B8"/>
            <property name="username" value="root"/>
            <property name="password" value="0614"/>
        </dataSource>
    </environment>
</environments>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - default：根据切换environment的id值，从而切换数据库</span><br><span class="line"></span><br><span class="line">  - transactionManager：事务管理</span><br><span class="line"></span><br><span class="line">    - MyBatis两种事务管理器：**JDBC**和**MANAGED**</span><br><span class="line">    - **JDBC：**此配置直接使用了JDBC的**提交**和**回滚**设置，它依赖于从**数据源**得到的**连接**来**管理事务**的作用域。</span><br><span class="line">    - **MANAGED：**此配置从来**不提交或回滚一个连接**，而是让**容器来管理事务**的整个生命周期。在默认情况下，它会**关闭连接**，但一些容器并不希望这样，为此可以将**closeConnection属性设置为false**来阻止它默认的关闭行为。</span><br><span class="line">    - **注意：**如果项目中使用的是**Spring+ MyBatis**，则没有必要在MyBatis中配置事务管理器，因为实际开发中，会使用**Spring自带的管理器**来实现**事务管理**。</span><br><span class="line"></span><br><span class="line">  - dataSource：用于配置数据源</span><br><span class="line"></span><br><span class="line">    - **MyBatis框架提供了UNPOOLED、POOLED和JNDI三种数据源类型**</span><br><span class="line">    - **UNPOOLED：**配置此数据源类型后，在每次被请求时会打开和关闭连接。它对没有性能要求的简单应用程序是一个很好的选择。</span><br><span class="line">      - 配置属性</span><br><span class="line">      - ![1650266919471](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650266919471.png)</span><br><span class="line">    - **POOLED：**这种方式使得并发Web应用可以快速地响应请求，是当前流行的处理方式。</span><br><span class="line">      - 额外可配置属性</span><br><span class="line">      - ![1650267041817](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650267041817.png)</span><br><span class="line">    - **JNDI：**此数据源可以在EJB或应用服务器等容器中使用。容器可以集中或在外部配置数据源，然后放置一个JNDI上下文的引用。</span><br><span class="line">      - 需要配置属性</span><br><span class="line">      - ![1650267136273](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650267136273.png)</span><br><span class="line"></span><br><span class="line">- **&lt;mappers&gt;元素：**用于指定MyBatis映射文件的位置</span><br><span class="line"></span><br><span class="line">  - **四种配置方式**</span><br><span class="line"></span><br><span class="line">    - 类路径</span><br><span class="line"></span><br><span class="line">      ```xml</span><br><span class="line">      &lt;mapper resource=&quot;com/itzjc/mapper/UserMapper.xml&quot;/&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>本地文件路径</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;本地文件路径&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>本地接口</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.itzjc.mapper.BrandMapper&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>包名引入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.itzjc.mapper&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="7-3-映射文件中常用的元素"><a href="#7-3-映射文件中常用的元素" class="headerlink" title="7.3 映射文件中常用的元素"></a>7.3 映射文件中常用的元素</h2><p>映射文件是MyBatis框架中十分重要的文件，可以说，MyBatis框架的强大之处就体现在映射文件的编写上。</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650267626150.png" alt="1650267626150"></p>
<ul>
<li><p>**<mapper>**：是映射文件的根元素</p>
<ul>
<li>namespace属性：映射文件的文件地址</li>
</ul>
</li>
<li><p><strong><select>：</strong>映射查询语句。</p>
<ul>
<li><pre><code class="xml">&lt;select id=&quot;selectById&quot; resultType=&quot;com.itzjc.pojo.Brand&quot; parameterType=&quot;integer&quot;&gt;
        select * from tb_brand where id = #&#123;id&#125;;
&lt;/select&gt;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - **常用属性**</span><br><span class="line"></span><br><span class="line">    - ![1650267989625](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650267989625.png)</span><br><span class="line"></span><br><span class="line">- **&lt;insert&gt;：**用于映射插入语句</span><br><span class="line"></span><br><span class="line">  - 属性与select大部分相同，还含有3个特有属性</span><br><span class="line">    - ![1650268174291](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650268174291.png)</span><br><span class="line"></span><br><span class="line">- **&lt;update&gt;元素和&lt;delete&gt;元素**</span><br><span class="line"></span><br><span class="line">- **&lt;sql&gt;元素：**定义可重用的SQL代码片段</span><br><span class="line"></span><br><span class="line">  - 例如查找的对象为可重复sql</span><br><span class="line"></span><br><span class="line">    ```xml</span><br><span class="line">    &lt;sql id=&quot;brandColumns&quot;&gt;id,brand_name,ordered&lt;/sql&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;select id=&quot;selectById&quot; resultType=&quot;com.itzjc.pojo.Brand&quot; parameterType=&quot;integer&quot;&gt;</span><br><span class="line">            select &lt;include refid=&quot;brandColumns&quot;/&gt; from tb_brand where id = #&#123;id&#125;;</span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>可选sql</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    定义表的前缀名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;brand&quot;</span>&gt;</span></span><br><span class="line">        $&#123;prefix&#125;brand</span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    定义要查询的表--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;someInclude&quot;</span>&gt;</span></span><br><span class="line">        from <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;$&#123;include_target&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    定义查询列--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;brandColumns&quot;</span>&gt;</span></span><br><span class="line">        id,brand_name,ordered</span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itzjc.pojo.Brand&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;integer&quot;</span>&gt;</span></span><br><span class="line">            select</span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;brandColumns&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;someInclude&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tb_&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;include_target&quot;</span> <span class="attr">value</span>=<span class="string">&quot;brand&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            where id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上述代码中，定义了3个代码片段，分别为表的前缀名、要查询的表和需要查询的列。前两个代码片段中，分别获取了<include>子元素<property>中的值，其中第1个代码片段中的“${prefix}”会获取name为prefix的值“t_”，获取后所组成的表名为“t_customer”；而第2个代码片段的“${include_target}”会获取name为include_target的值“tablename”，由于tablename为第1个SQL片段的id值，所以最后要查询的表为“t_customer”。所有的SQL片段在程序运行时，都会由MyBatis组合成SQL语句来执行需要的操作。</p>
</li>
</ul>
</li>
<li><p><resultMap>：定义映射规则、级联的更新以及定义类型转化器等。</p>
<ul>
<li><p><strong>结构</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;&quot;</span>&gt;</span>       <span class="comment">&lt;!--type属性表示需要映射的POJO--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor</span>&gt;</span>               <span class="comment">&lt;!--类在实例化时，用来注入结果的构造方法--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">idArg</span>/&gt;</span>                <span class="comment">&lt;!--id参数；标记结果作为id--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg</span>/&gt;</span>                  <span class="comment">&lt;!--注入到构造方法的一个普通结果--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">constructor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>/&gt;</span>                       <span class="comment">&lt;!--用于表示哪个列是主键--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span>/&gt;</span>                   <span class="comment">&lt;!--注入到字段或Javabean属性的普通结果--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;&quot;</span>/&gt;</span>  <span class="comment">&lt;!--一对一关联--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;&quot;</span>/&gt;</span>   <span class="comment">&lt;!--一对多关联--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">discriminator</span> <span class="attr">javaType</span>=<span class="string">&quot;&quot;</span>&gt;</span> <span class="comment">&lt;!--使用结果值来决定哪个结果的映射--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span>        <span class="comment">&lt;!--基于某些值的结果--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">discriminator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当数据库表数据列明与pojo对象名不一致时，可修改映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;resultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.itzjc.pojo.Brand&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;brandName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;brand_name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;companyName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;company_name&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h1 id="8-动态sql"><a href="#8-动态sql" class="headerlink" title="8.动态sql"></a>8.动态sql</h1><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650278202256.png" alt="1650278202256"></p>
<ul>
<li><if> 

<ul>
<li><p>多项条件选择查询，因为给的where 1&#x3D;1，所有默认为查询所有</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectOne&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;resultMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;brand&quot;</span>&gt;</span></span><br><span class="line">       select * from tb_brand where 1=1</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand.id != null&quot;</span>&gt;</span></span><br><span class="line">            and id = #&#123;brand.id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand.brandName != null and brand.brandName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and brand_name like concat(&#x27;%&#x27;,#&#123;brand.brandName&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand.companyName != null and brand.companyName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and company_name like concat(&#x27;%&#x27;,#&#123;brand.companyName&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><choose>、<when>、<otherwise> 类似switch…case…default</p>
<ul>
<li><p>单项条件查询</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;select&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;resultMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;brand&quot;</span>&gt;</span></span><br><span class="line">    select * from tb_brand where 1=1</span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;brand.brandName != null and brand.brandName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and brand_name like concat(&#x27;%&#x27;,#&#123;brand.brandName&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;brand.companyName != null and brand.companyName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and company_name like concat(&#x27;%&#x27;,#&#123;brand.companyName&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">            and brand is not null;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当满足第一个when时不会执行下面的when。</p>
</li>
</ul>
</li>
<li><p><where>、<trim></p>
<ul>
<li><p><where>可以使sql不加1 &#x3D; 1实现where and 的连接，即检测到where and连在一起时自动删除and。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;select&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;resultMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;brand&quot;</span>&gt;</span></span><br><span class="line">    select * from tb_brand</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;brand.brandName != null and brand.brandName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and brand_name like concat(&#x27;%&#x27;,#&#123;brand.brandName&#125;,&#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;brand.companyName != null and brand.companyName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and company_name like concat(&#x27;%&#x27;,#&#123;brand.companyName&#125;,&#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">                and brand is not null;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><trim>可以去除一些特殊字符</p>
<ul>
<li>&#96;&#96;&#96;xml<select id="select" resultMap="resultMap" parameterType="brand">
    select * from tb_brand
    <trim prefix="where" prefixOverrides="and">
        <choose>
            <when test="brand.brandName != null and brand.brandName != ''">
                and brand_name like concat('%',#{brand.brandName},'%')
            </when>
            <when test="brand.companyName != null and brand.companyName != ''">
                and company_name like concat('%',#{brand.companyName},'%')
            </when>
            <otherwise>
                and brand is not null;
            </otherwise>
        </choose>
    </trim>
</select>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- &lt;set&gt;在动态包含的SQL语句前输出一个SET关键字，并将SQL语句中**最后一个多余的逗号**去除。</span><br><span class="line"></span><br><span class="line">  - ```xml</span><br><span class="line">    &lt;update id=&quot;setBrand&quot; parameterType=&quot;brand&quot;&gt;</span><br><span class="line">        update tb_brand</span><br><span class="line">        &lt;set&gt;</span><br><span class="line">            &lt;if test=&quot;brand.brandName != null and brand.brandName != &#x27;&#x27;&quot;&gt;</span><br><span class="line">                brand_name = #&#123;brand.brandName&#125;,</span><br><span class="line">            &lt;/if&gt;</span><br><span class="line">            &lt;if test=&quot;brand.companyName != null and brand.companyName != &#x27;&#x27;&quot;&gt;</span><br><span class="line">                company_name = #&#123;brand.companyName&#125;,</span><br><span class="line">            &lt;/if&gt;</span><br><span class="line">        &lt;/set&gt;</span><br><span class="line">            where id = #&#123;brand.id&#125;</span><br><span class="line">    &lt;/update&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><foreach>

<ul>
<li><p>查找id在in（0,1,2,3）内的brand</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByIds&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;resultMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int[]&quot;</span>&gt;</span></span><br><span class="line">    select * from tb_brand where id in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">        #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>collection传参</p>
<p>（1）如果传入的是<strong>单参数</strong>且参数类型是一个数组或者List的时候，collection属性值分别为<strong>array和list</strong>（或collection）。</p>
<p>（2）如果传入的参数是多个的时候，就需要把它们<strong>封装成一个Map</strong>了，当然单参数也可以封装成Map集合，这时候collection属性值就为<strong>Map的键</strong>。</p>
<p>（3）如果传入的参数是<strong>POJO包装类</strong>的时候，collection属性值就为该包装类中需要进行遍历的<strong>数组或集合</strong>的属性名。</p>
</li>
</ul>
</li>
<li><p><bind>模糊查询编写</p>
<ul>
<li>&#96;&#96;&#96;xml<select id="selectByBrandName" resultMap="resultMap" parameterType="string">
    <bind name="brandName" value="'%' + brandName + '%'"/>
    select * from tb_brand where brand_name like #{brandName}
</select>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">      name:定义变量        value：该变量的值</span><br><span class="line"></span><br><span class="line"># 9.MyBatis的关联映射</span><br><span class="line"></span><br><span class="line">学习目标</span><br><span class="line"></span><br><span class="line">● 了解数据表之间以及对象之间的三种关联关系</span><br><span class="line"></span><br><span class="line">● 熟悉关联关系中的嵌套查询和嵌套结果</span><br><span class="line"></span><br><span class="line">● 掌握一对一、一对多和多对多关联映射的使用</span><br><span class="line"></span><br><span class="line">## 9.1 关联关系</span><br><span class="line"></span><br><span class="line">- **多表之间的关联：**在关系型数据库中，多表之间存在着三种关联关系，分别为**一对一**、**一对多**和**多对多**。</span><br><span class="line">  - ![1650368502260](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650368502260.png)</span><br><span class="line">  - **· 一对一：**在任意一方引入对方主键作为外键。</span><br><span class="line">  - **· 一对多：**在“多”的一方，添加“一”的一方的主键作为外键。</span><br><span class="line">  - **· 多对多：**产生中间关系表，引入两张表的主键作为外键，两个主键成为联合主键或使用新的字段作为主键。</span><br><span class="line">- **java中的关系描述**</span><br><span class="line">  - ![1650368644241](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650368644241.png)</span><br><span class="line">  - **· 一对一的关系：**就是在本类中定义对方类型的对象，如A类中定义B类类型的属性b, B类中定义A类类型的属性a。</span><br><span class="line">  - **· 一对多的关系：**就是一个A类类型对应多个B类类型的情况，需要在A类中以集合的方式引入B类类型的对象，在B类中定义A类类型的属性a。</span><br><span class="line">  - **· 多对多的关系：**在A类中定义B类类型的集合，在B类中定义A类类型的集合。</span><br><span class="line"></span><br><span class="line">## 9.2嵌套查询和嵌套结果</span><br><span class="line"></span><br><span class="line">MyBatis在映射文件中加载关联关系对象主要通过两种方式：嵌套查询和嵌套结果。</span><br><span class="line"></span><br><span class="line">- **嵌套查询**是指通过执行另外一条SQL映射语句来返回预期的复杂类型；</span><br><span class="line">- **嵌套结果**是使用嵌套结果映射来处理重复的联合结果的子集。</span><br><span class="line">- 开发人员可以使用上述任意一种方式实现对关联关系的加载。</span><br><span class="line"></span><br><span class="line">## 9.3 一对一</span><br><span class="line"></span><br><span class="line">- &lt;association&gt;可处理一对一的关系</span><br><span class="line"></span><br><span class="line">  - 可以配置属性</span><br><span class="line"></span><br><span class="line">    - **· property：**指定映射到的实体类对象属性，与表字段一一对应。</span><br><span class="line">    - **· column：**指定表中对应的字段。</span><br><span class="line">    - **· javaType：**指定映射到实体对象属性的类型。</span><br><span class="line">    - **· select：**指定引入嵌套查询的子SQL语句，该属性用于关联映射中的嵌套查询。</span><br><span class="line">    - **· fetchType：**指定在关联查询时是否启用延迟加载。fetchType属性有lazy和eager两个属性值，默认值为lazy（即默认关联映射延迟加载）。</span><br><span class="line"></span><br><span class="line">  - **需求：**查询个人及其关联的身份证信息是先通过查询个人表中的主键来获个人信息，然后通过表中的外键，来获取证件表中的身份证号信息。</span><br><span class="line"></span><br><span class="line">  - **1.创建数据表**</span><br><span class="line"></span><br><span class="line">    - ```sql</span><br><span class="line">      #创建一个身份证卡表</span><br><span class="line">      CREATE TABLE tb_idcard(</span><br><span class="line">      id Int PRIMARY KEY auto_increment,</span><br><span class="line">      code VARCHAR(18)</span><br><span class="line">      );</span><br><span class="line">      #创建个人表</span><br><span class="line">      CREATE TABLE tb_person(</span><br><span class="line">      id int PRIMARY KEY auto_increment,</span><br><span class="line">      NAME VARCHAR(32),</span><br><span class="line">      age INT,</span><br><span class="line">      sex VARCHAR(2),</span><br><span class="line">      card_id INT UNIQUE,</span><br><span class="line">      #设计外键</span><br><span class="line">      FOREIGN KEY(card_id) REFERENCES tb_idcard(id)</span><br><span class="line">      );</span><br><span class="line">      </span><br><span class="line">      #插入身份证数据</span><br><span class="line">      INSERT INTO tb_idcard(code) VALUES(&#x27;123456789&#x27;);</span><br><span class="line">      INSERT INTO tb_idcard(code) VALUES(&#x27;987654321&#x27;);</span><br><span class="line">      #插入个人信息</span><br><span class="line">      INSERT INTO tb_person(NAME,age,sex,card_id) VALUES(&#x27;Rose&#x27;,29,&#x27;女&#x27;,1);</span><br><span class="line">      INSERT INTO tb_person(NAME,age,sex,card_id) VALUES(&#x27;Tom&#x27;,28,&#x27;男&#x27;,2);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>2.创建pojo类</p>
<ul>
<li><p>IdCard类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IdCard</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;IdCard&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, code=&quot;</span> + code +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(Integer code)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>person类，注意：card_id只是个连接idcard的外键，可将外键属性直接关联证据类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Character sex;</span><br><span class="line">    <span class="keyword">private</span> IdCard idCard;<span class="comment">//个人关联的证件</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> IdCard <span class="title function_">getIdCard</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> idCard;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setIdCard</span><span class="params">(IdCard idCard)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.idCard = idCard;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(Integer age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Character <span class="title function_">getSex</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSex</span><span class="params">(Character sex)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, sex=&quot;</span> + sex +</span><br><span class="line">                <span class="string">&quot;, idCard=&quot;</span> + idCard +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>3.创建接口及映射文件</p>
<ul>
<li><p>idcardMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IdCardMapper</span> &#123;</span><br><span class="line">    IdCard <span class="title function_">findCodeById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>personMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PersonMapper</span> &#123;</span><br><span class="line">    Person <span class="title function_">findPersonById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>写下查找idcard的sql</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itzjc.mapper.IdCardMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findCodeById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;IdCard&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;integer&quot;</span>&gt;</span></span><br><span class="line">        select * from tb_idcard where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>嵌套查询</strong>，嵌入IdCard sql返回值为property&#x3D;”idCard”，查找的id为column&#x3D;”card_id”，返回类为javaType&#x3D;”IdCard”。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itzjc.mapper.PersonMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--嵌套查询--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;IdCardWithPerson&quot;</span> <span class="attr">type</span>=<span class="string">&quot;person&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--设置表的一对一关系，select属性引入另外一条sql--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;idCard&quot;</span> <span class="attr">column</span>=<span class="string">&quot;card_id&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;IdCard&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.itzjc.mapper.IdCardMapper.findCodeById&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findPersonById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;IdCardWithPerson&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;integer&quot;</span>&gt;</span></span><br><span class="line">        select * from tb_person where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>调试</strong></p>
<ul>
<li>&#96;&#96;&#96;java<br>public class IdWithPersonTest {<br>@Test<br>public void findPersonByIdTest() throws Exception {<br>    &#x2F;&#x2F;1.读取文件<br>    InputStream inputStream &#x3D; Resources.getResourceAsStream(“mybatis_config.xml”);<br>    &#x2F;&#x2F;2.获得sqlSessionFactory工厂对象<br>    SqlSessionFactory sqlSessionFactory &#x3D; new SqlSessionFactoryBuilder().build(inputStream);<br>    &#x2F;&#x2F;3.获得sqlSession对象<br>    SqlSession sqlSession &#x3D; sqlSessionFactory.openSession();<br>    &#x2F;&#x2F;4.获得mapper接口<br>    PersonMapper personMapper &#x3D; sqlSession.getMapper(PersonMapper.class);<br>    &#x2F;&#x2F;5.调用方法<br>    Person personById &#x3D; personMapper.findPersonById(1);<br>    System.out.println(personById);<br>    &#x2F;&#x2F;6.关闭sqlSession对象<br>    sqlSession.close();<br><br>}<br>}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 结果</span><br><span class="line"></span><br><span class="line">  - ```</span><br><span class="line">    Person&#123;id=1, name=&#x27;Rose&#x27;, age=29, sex=女, idCard=IdCard&#123;id=1, code=123456789&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>嵌套结果：</strong>不用另外写sql，直接一条sql查询</p>
</li>
<li><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;mapper namespace=&quot;com.itzjc.mapper.PersonMapper&quot;&gt;
    &lt;!--嵌套结果--&gt;
    &lt;resultMap id=&quot;IdCardWithPerson&quot; type=&quot;person&quot;&gt;
        &lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;
        &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;
        &lt;result property=&quot;age&quot; column=&quot;age&quot;/&gt;
        &lt;result property=&quot;sex&quot; column=&quot;sex&quot;/&gt;
        &lt;association property=&quot;idCard&quot; javaType=&quot;IdCard&quot;&gt;
            &lt;id property=&quot;id&quot; column=&quot;card_id&quot;/&gt;
            &lt;result property=&quot;code&quot; column=&quot;code&quot;/&gt;
        &lt;/association&gt;
    &lt;/resultMap&gt;
    &lt;select id=&quot;findPersonById&quot; resultMap=&quot;IdCardWithPerson&quot; parameterType=&quot;integer&quot;&gt;
                select p.*,idcard.code from tb_person p,tb_idcard idcard where p.card_id = idcard.id and p.id = #&#123;id&#125;
    &lt;/select&gt;
&lt;/mapper&gt;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- **MyBatis延迟加载的配置**</span><br><span class="line"></span><br><span class="line">  - mybatis_config.xml</span><br><span class="line"></span><br><span class="line">    ```xml</span><br><span class="line">    &lt;settings&gt;</span><br><span class="line">        &lt;!--打开延迟加载的开关--&gt;</span><br><span class="line">        &lt;setting name=&quot;lazyLoadingEnabled&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;!--将积极加载改为消息加载，即按需加载--&gt;</span><br><span class="line">        &lt;setting name=&quot;aggressiveLazyLoading&quot; value=&quot;false&quot;/&gt;</span><br><span class="line">    &lt;/settings&gt;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p><association>元素默认属性fetchType&#x3D;”lazy”（属性fetchType&#x3D;”eager”表示立即加载）。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="9-4一对多"><a href="#9-4一对多" class="headerlink" title="9.4一对多"></a>9.4一对多</h2><p>一个人对应多个订单</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650377820575.png" alt="1650377820575"></p>
<ul>
<li><collection>
- ![1650377944432](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650377944432.png)

<ul>
<li><p>ofType对应<association>的javaType</p>
</li>
<li><p>法一：嵌入查询</p>
<ul>
<li><p>定义user</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Orders&gt; orders;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUserName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserName</span><span class="params">(String userName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAddress</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddress</span><span class="params">(String address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Orders&gt; <span class="title function_">getOrders</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> orders;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOrders</span><span class="params">(List&lt;Orders&gt; orders)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orders = orders;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, userName=&#x27;&quot;</span> + userName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, address=&#x27;&quot;</span> + address + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, orders=&quot;</span> + orders +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义orders查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrdersMapper</span> &#123;</span><br><span class="line">    List&lt;Orders&gt; <span class="title function_">findOrdersByUserId</span><span class="params">(<span class="type">int</span> userId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itzjc.mapper.OrdersMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findOrdersByUserId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Orders&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;integer&quot;</span>&gt;</span></span><br><span class="line">            select * from tb_orders where user_id = #&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将order查询结果嵌入user查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    User <span class="title function_">findUserById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itzjc.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;userName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;orders&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;orders&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.itzjc.mapper.OrdersMapper.findOrdersByUserId&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userMap&quot;</span>&gt;</span></span><br><span class="line">            select *</span><br><span class="line">            from tb_user where id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>法二：嵌套结果</p>
<ul>
<li><p>定义user类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Orders&gt; orders;<span class="comment">//一对多</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUserName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserName</span><span class="params">(String userName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAddress</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddress</span><span class="params">(String address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Orders&gt; <span class="title function_">getOrders</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> orders;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOrders</span><span class="params">(List&lt;Orders&gt; orders)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orders = orders;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, userName=&#x27;&quot;</span> + userName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, address=&#x27;&quot;</span> + address + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, orders=&quot;</span> + orders +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>嵌入结果sql</p>
<ul>
<li>&#96;&#96;&#96;xml<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itzjc.mapper.UserMapper">

<pre><code>&lt;resultMap id=&quot;userMap&quot; type=&quot;user&quot;&gt;
    &lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;
    &lt;result property=&quot;userName&quot; column=&quot;username&quot;/&gt;
    &lt;result property=&quot;address&quot; column=&quot;address&quot;/&gt;
    &lt;!--嵌入结果 property对应User属性，ofType对应属性的类型--&gt;
    &lt;collection property=&quot;orders&quot; ofType=&quot;orders&quot;&gt;
        &lt;!--嵌入结果的主键--&gt;
        &lt;id property=&quot;id&quot; column=&quot;order_id&quot;/&gt;
        &lt;!--嵌入结果的number属性--&gt;
        &lt;result property=&quot;number&quot; column=&quot;number&quot;/&gt;
    &lt;/collection&gt;
    
&lt;/resultMap&gt;
&lt;!--多表查询的sql--&gt;
&lt;select id=&quot;findUserById&quot; resultMap=&quot;userMap&quot;&gt;
    select u.*,orders.id as order_id,orders.number from tb_user u ,tb_orders orders where u.id = orders.user_id and u.id=#&#123;id&#125;
&lt;/select&gt;
</code></pre>
</mapper>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 9.5 多对多</span><br><span class="line"></span><br><span class="line">![1650451860836](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650451860836.png)</span><br><span class="line"></span><br><span class="line">- 1.创建数据库表的多对多关系</span><br><span class="line"></span><br><span class="line">  - 一个商品对应有多个订单，一个订单对应有多个商品</span><br><span class="line"></span><br><span class="line">    ```sql</span><br><span class="line">    #创建product表</span><br><span class="line">    CREATE TABLE tb_product(</span><br><span class="line">    id Int PRIMARY KEY auto_increment,</span><br><span class="line">    name VARCHAR(32),</span><br><span class="line">    price DOUBLE</span><br><span class="line">    );</span><br><span class="line">    INSERT INTO tb_product VALUES(&#x27;1&#x27;,&#x27;java基础入门&#x27;,&#x27;44.5&#x27;);</span><br><span class="line">    INSERT INTO tb_product VALUES(&#x27;2&#x27;,&#x27;java web程序开发入门&#x27;,&#x27;38.5&#x27;);</span><br><span class="line">    INSERT INTO tb_product VALUES(&#x27;3&#x27;,&#x27;ssm框架整合实战&#x27;,&#x27;50&#x27;);</span><br><span class="line">    #创建中间表</span><br><span class="line">    CREATE TABLE tb_ordersitem(</span><br><span class="line">    id Int PRIMARY KEY auto_increment,</span><br><span class="line">    orders_id INT,</span><br><span class="line">    product_id INT,</span><br><span class="line">    FOREIGN KEY (orders_id) REFERENCES tb_orders(id),</span><br><span class="line">    FOREIGN KEY (product_id) REFERENCES tb_product(id)</span><br><span class="line">    );</span><br><span class="line">    INSERT INTO tb_ordersitem VALUES (&#x27;1&#x27;,&#x27;1&#x27;,&#x27;1&#x27;);</span><br><span class="line">    INSERT INTO tb_ordersitem VALUES (&#x27;2&#x27;,&#x27;1&#x27;,&#x27;3&#x27;);</span><br><span class="line">    INSERT INTO tb_ordersitem VALUES (&#x27;3&#x27;,&#x27;3&#x27;,&#x27;3&#x27;);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p>数据表关系</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650457418085.png" alt="1650457418085"></p>
</li>
</ul>
</li>
<li><p>2.需求：查找id为3的产品及其对应的订单</p>
<ul>
<li><p>嵌入查询</p>
<ul>
<li><p>1.编写嵌入的订单集合</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrdersMapper</span> &#123;</span><br><span class="line">    List&lt;Orders&gt; <span class="title function_">findOrdersByUserId</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itzjc.mapper.OrdersMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findOrdersByUserId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Orders&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;integer&quot;</span>&gt;</span></span><br><span class="line">            select * from tb_orders where id in</span><br><span class="line">        <span class="comment">&lt;!--查找商品id=？对应的订单orders_id--&gt;</span></span><br><span class="line">        (select orders_id from tb_ordersitem where product_id = #&#123;id&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2.嵌入到商品查询中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductMapper</span> &#123;</span><br><span class="line">    List&lt;Product&gt; <span class="title function_">findProductById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itzjc.mapper.ProductMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;ProductMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;product&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--嵌入findOrdersByUserId查询的结果到ordersList集合属性中--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;ordersList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;orders&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.itzjc.mapper.OrdersMapper.findOrdersByUserId&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findProductById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;ProductMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;integer&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from tb_product where id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>嵌入结果</p>
<ul>
<li>&#96;&#96;&#96;java<br>public interface ProductMapper {<br>List<Product> findProductById(int id);<br>}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.itzjc.mapper.ProductMapper&quot;&gt;</span><br><span class="line">    &lt;resultMap id=&quot;ProductMap&quot; type=&quot;product&quot;&gt;</span><br><span class="line">        &lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;price&quot; column=&quot;price&quot;/&gt;</span><br><span class="line">        &lt;!--嵌入结果的数据--&gt;</span><br><span class="line">        &lt;collection property=&quot;ordersList&quot; ofType=&quot;orders&quot;&gt;</span><br><span class="line">            &lt;id property=&quot;id&quot; column=&quot;oid&quot;/&gt;</span><br><span class="line">            &lt;result property=&quot;number&quot; column=&quot;number&quot;/&gt;</span><br><span class="line">        &lt;/collection&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line">    &lt;select id=&quot;findProductById&quot; resultMap=&quot;ProductMap&quot; parameterType=&quot;integer&quot;&gt;</span><br><span class="line">        &lt;!--多表查询sql--&gt;</span><br><span class="line">        select p.*,o.id as oid ,o.number from tb_product p,tb_ordersitem oi,tb_orders o</span><br><span class="line">        where p.id = oi.product_id and o.id = oi.orders_id and p.id = #&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="10-MyBatis与Spring整合"><a href="#10-MyBatis与Spring整合" class="headerlink" title="10.MyBatis与Spring整合"></a>10.MyBatis与Spring整合</h1><p>学习目标</p>
<p>● 掌握传统DAO方式的开发整合</p>
<p>● 掌握Mapper接口方式的开发整合</p>
<h2 id="10-1整合配置"><a href="#10-1整合配置" class="headerlink" title="10.1整合配置"></a>10.1整合配置</h2><ul>
<li><p>导入坐标</p>
<ul>
<li>&#96;&#96;&#96;xml<dependencies>
    <!--Spring Ioc-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
        <version>5.0.5.RELEASE</version>
    </dependency>
    <!--Spring AOP-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-aop</artifactId>
        <version>5.0.5.RELEASE</version>
    </dependency>
    <dependency>
        <groupId>aopalliance</groupId>
        <artifactId>aopalliance</artifactId>
        <version>1.0</version>
    </dependency>
    <dependency>
        <groupId>org.aspectj</groupId>
        <artifactId>aspectjweaver</artifactId>
        <version>1.8.10</version>
    </dependency>
    <!--JDBC 与 tx 与 mysql-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-jdbc</artifactId>
        <version>5.0.5.RELEASE</version>
    </dependency>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-tx</artifactId>
        <version>5.0.5.RELEASE</version>
    </dependency>
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>8.0.16</version>
    </dependency>
    <!--mybatis-->
    <dependency>
        <groupId>org.mybatis</groupId>
        <artifactId>mybatis</artifactId>
        <version>3.5.5</version>
    </dependency>
    <!--mybatis与Spring的中间jar-->
    <dependency>
        <groupId>org.mybatis</groupId>
        <artifactId>mybatis-spring</artifactId>
        <version>1.3.1</version>
    </dependency>
    <!--连接池-->
    <dependency>
        <groupId>com.alibaba</groupId>
        <artifactId>druid</artifactId>
        <version>1.1.12</version>
    </dependency>
</dependencies>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- application.xml   Spring配置</span><br><span class="line"></span><br><span class="line">  - ```xml</span><br><span class="line">    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">    &lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">           xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">           xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">           xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">           xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;</span><br><span class="line">           xsi:schemaLocation=&quot;</span><br><span class="line">           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd</span><br><span class="line">           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span><br><span class="line">           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd</span><br><span class="line">    &quot;&gt;</span><br><span class="line">        &lt;!--读取属性文件--&gt;</span><br><span class="line">        &lt;context:property-placeholder location=&quot;jdbc.properties&quot;/&gt;</span><br><span class="line">        &lt;!--配置数据源--&gt;</span><br><span class="line">        &lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;</span><br><span class="line">            &lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;jdbc.driver&#125;&quot;/&gt;</span><br><span class="line">            &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/&gt;</span><br><span class="line">            &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.user&#125;&quot;/&gt;</span><br><span class="line">            &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/&gt;</span><br><span class="line">            &lt;property name=&quot;initialSize&quot; value=&quot;$&#123;jdbc.initialSize&#125;&quot;/&gt;</span><br><span class="line">        &lt;/bean&gt;</span><br><span class="line">        &lt;!--事务管理器，依赖于数据源--&gt;</span><br><span class="line">        &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">            &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;</span><br><span class="line">        &lt;/bean&gt;</span><br><span class="line">        &lt;!--开始事务注解--&gt;</span><br><span class="line">        &lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;/&gt;</span><br><span class="line">        &lt;!--配置MyBatis工厂--&gt;</span><br><span class="line">        &lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;</span><br><span class="line">            &lt;!--注入数据源--&gt;</span><br><span class="line">            &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;</span><br><span class="line">            &lt;!--指定核心配置文件位置--&gt;</span><br><span class="line">            &lt;property name=&quot;configLocation&quot; value=&quot;classpath:mybatis_config.xml&quot;/&gt;</span><br><span class="line">        &lt;/bean&gt;</span><br><span class="line">    &lt;/beans&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>JDBC属性文件</p>
<ul>
<li>&#96;&#96;&#96;properties<br>jdbc.driver &#x3D; com.mysql.cj.jdbc.Driver<br>jdbc.url &#x3D; jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;dbl2?serverTimezone&#x3D;GMT%2B8&amp;useSSL&#x3D;false&amp;useServerPrepStmts&#x3D;true<br>jdbc.user &#x3D; root<br>jdbc.password &#x3D; 0614<br>#数据库连接池的最大连接数（maxTotal）<br>jdbc.maxTotal &#x3D; 30<br>#最大空闲连接数（maxIdle）<br>jdbc.maxIdle &#x3D; 10<br>#初始化连接数（initialSize）<br>jdbc.initialSize &#x3D; 5<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- mybatis_config</span><br><span class="line"></span><br><span class="line">  - ```xml</span><br><span class="line">    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">    &lt;!DOCTYPE configuration</span><br><span class="line">            PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">            &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">    </span><br><span class="line">        &lt;settings&gt;</span><br><span class="line">            &lt;!--打开延迟加载的开关--&gt;</span><br><span class="line">            &lt;setting name=&quot;lazyLoadingEnabled&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">            &lt;!--将积极加载改为消息加载，即按需加载--&gt;</span><br><span class="line">            &lt;setting name=&quot;aggressiveLazyLoading&quot; value=&quot;false&quot;/&gt;</span><br><span class="line">        &lt;/settings&gt;</span><br><span class="line">        &lt;!-- 起别名 --&gt;</span><br><span class="line">        &lt;typeAliases&gt;</span><br><span class="line">            &lt;package name=&quot;com.itzjc.pojo&quot;/&gt;</span><br><span class="line">        &lt;/typeAliases&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;mappers&gt;</span><br><span class="line">            &lt;package name=&quot;com.itzjc.mapper&quot;/&gt;</span><br><span class="line">        &lt;/mappers&gt;</span><br><span class="line">    &lt;/configuration&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="10-2-传统DAO方式整合"><a href="#10-2-传统DAO方式整合" class="headerlink" title="10.2 传统DAO方式整合"></a>10.2 传统DAO方式整合</h2><h2 id="10-3-基于MapperFactoryBean的整合"><a href="#10-3-基于MapperFactoryBean的整合" class="headerlink" title="10.3 基于MapperFactoryBean的整合"></a>10.3 基于MapperFactoryBean的整合</h2><p><strong>MapperFactoryBean</strong>是MyBatis-Spring团队提供的一个用于根据<strong>Mapper</strong>接口生成<strong>Mapper对象</strong>的类，该类在Spring配置文件中使用时可以配置以下参数。</p>
<ul>
<li><p><strong>· mapperInterface：</strong>用于指定接口。</p>
</li>
<li><p><strong>· SqlSessionFactory：</strong>用于指定SqlSessionFactory。</p>
</li>
<li><p><strong>· SqlSessionTemplate：</strong>用于指定SqlSessionTemplate。如果与SqlSessionFactory同时设定，则只会启用SqlSessionTemplate。</p>
</li>
<li><p>整合步骤</p>
<ul>
<li><p>创建Mapper接口</p>
<ul>
<li>&#96;&#96;&#96;java<br>public interface PersonMapper {<br>&#x2F;&#x2F;通过用户id查找客户<br>Person findPersonById(Integer id);<br>}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 设置Mapper接口的配置文件</span><br><span class="line"></span><br><span class="line">  - ```xml</span><br><span class="line">    &lt;mapper namespace=&quot;com.itzjc.mapper.PersonMapper&quot;&gt;</span><br><span class="line">        &lt;!--根据id查找客户--&gt;</span><br><span class="line">        &lt;select id=&quot;findPersonById&quot; resultType=&quot;Person&quot; parameterType=&quot;integer&quot;&gt;</span><br><span class="line">            select *</span><br><span class="line">            from tb_person</span><br><span class="line">            where id = #&#123;id&#125;;</span><br><span class="line">        &lt;/select&gt;</span><br><span class="line">    &lt;/mapper&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>配置Spring整合Mapper</p>
<ul>
<li>&#96;&#96;&#96;xml<!--配置Mapper代理开发(基于MapperFactoryBean)-->
<bean id="personMapper" class="org.mybatis.spring.mapper.MapperFactoryBean">
    <property name="mapperInterface" value="com.itzjc.mapper.PersonMapper"/>
    <property name="sqlSessionFactory" ref="sqlSessionFactory"/>
</bean>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 测试</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    public class DaoTest &#123;</span><br><span class="line">        @Test</span><br><span class="line">        public void MapperTest()&#123;</span><br><span class="line">            ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(&quot;application.xml&quot;);</span><br><span class="line">            PersonMapper personMapper = (PersonMapper) context.getBean(&quot;personMapper&quot;);</span><br><span class="line">            Person personById = personMapper.findPersonById(1);</span><br><span class="line">            System.out.println(personById);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>脚下留心：</p>
<ul>
<li>Mapper接口编程方式只需要程序员编写Mapper接口（相当于DAO接口），然后由MyBatis框架根据接口的定义创建接口的动态代理对象，这个代理对象的方法体等同于10.2小节中DAO接口的实现类方法。虽然使用Mapper接口编程的方式很简单，但是在具体使用时还是需要遵循以下规范。<ul>
<li>（1）Mapper接口的名称和对应的Mapper.xml映射文件的名称必须一致。</li>
<li>（2）Mapper.xml文件中的namespace与Mapper接口的类路径相同（即接口文件和映射文件需要放在同一个包中）。</li>
<li>（3）Mapper接口中的方法名和Mapper.xml中定义的每个执行语句的id相同。</li>
<li>（4）Mapper接口中方法的输入参数类型要和Mapper.xml中定义的每个sql的parameterType的类型相同。</li>
<li>（5）Mapper接口方法的输出参数类型要和Mapper.xml中定义的每个sql的resultType的类型相同。</li>
</ul>
</li>
<li>只要遵循了这些开发规范，MyBatis就可以自动生成Mapper接口实现类的代理对象，从而简化我们的开发。</li>
</ul>
</li>
</ul>
<h1 id="10-SpringMVC入门"><a href="#10-SpringMVC入门" class="headerlink" title="10.SpringMVC入门"></a>10.SpringMVC入门</h1><p>学习目标</p>
<p>● 了解Spring MVC的特点</p>
<p>● 掌握Spring MVC入门程序的编写</p>
<p>● 熟悉Spring MVC的工作流程</p>
<h2 id="10-1-SpringMVC的特点"><a href="#10-1-SpringMVC的特点" class="headerlink" title="10.1 SpringMVC的特点"></a>10.1 SpringMVC的特点</h2><ul>
<li>是Spring框架的一部分，可以方便地利用Spring所提供的其他功能。</li>
<li>· 灵活性强，<strong>易于与其他框架集成</strong>。</li>
<li>· 提供了一个<strong>前端控制器DispatcherServlet</strong>，使开发人员无须额外开发控制器对象。</li>
<li>· <strong>可自动绑定用户输入</strong>，并能<strong>正确的转换数据类型</strong>。</li>
<li>· 内置了常见的校验器，可以<strong>校验用户输入</strong>。如果校验不能通过，那么就会重定向到输入表单。</li>
<li>· <strong>支持国际化。</strong>可以根据用户区域显示多国语言。</li>
<li>· <strong>支持多种视图技术</strong>。它支持JSP、Velocity和FreeMarker等视图技术。</li>
<li>· <strong>使用基于XML的配置文件</strong>，在编辑后，不需要重新编译应用程序。</li>
</ul>
<h2 id="10-2-入门程序编写"><a href="#10-2-入门程序编写" class="headerlink" title="10.2 入门程序编写"></a>10.2 入门程序编写</h2><ul>
<li><p>导入相关坐标</p>
<ul>
<li>&#96;&#96;&#96;xml<build>
    <plugins>
        <plugin>
            <groupId>org.apache.tomcat.maven</groupId>
            <artifactId>tomcat7-maven-plugin</artifactId>
            <version>2.2</version>
        </plugin>
    </plugins>
</build>
<dependencies>
    <dependency>
        <groupId>javax.servlet</groupId>
        <artifactId>javax.servlet-api</artifactId>
        <version>3.1.0</version>
        <scope>provided</scope>
    </dependency>
    <dependency>
        <groupId>javax.servlet.jsp</groupId>
        <artifactId>javax.servlet.jsp-api</artifactId>
        <version>2.2.1</version>
        <scope>provided</scope>
    </dependency>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-web</artifactId>
        <version>5.0.5.RELEASE</version>
    </dependency>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
        <version>5.0.5.RELEASE</version>
    </dependency>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-webmvc</artifactId>
        <version>5.0.5.RELEASE</version>
    </dependency>
</dependencies>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- web配置</span><br><span class="line"></span><br><span class="line">  - ```xml</span><br><span class="line">    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">    &lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span><br><span class="line">             xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">             xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span><br><span class="line">             version=&quot;4.0&quot;&gt;</span><br><span class="line">        &lt;servlet&gt;</span><br><span class="line">    &lt;!--        配置前端过滤器--&gt;</span><br><span class="line">            &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class="line">            &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</span><br><span class="line">    &lt;!--        初始化加载配置文件--&gt;</span><br><span class="line">            &lt;init-param&gt;</span><br><span class="line">                &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">                &lt;param-value&gt;classpath:springmvc_config.xml&lt;/param-value&gt;</span><br><span class="line">            &lt;/init-param&gt;</span><br><span class="line">    &lt;!--        表示容器在启动时立即加载的Servlet--&gt;</span><br><span class="line">            &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">        &lt;/servlet&gt;</span><br><span class="line">        &lt;servlet-mapping&gt;</span><br><span class="line">            &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class="line">            &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">        &lt;/servlet-mapping&gt;</span><br><span class="line">    &lt;/web-app&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>springmvc_config.xml配置</p>
<ul>
<li>&#96;&#96;&#96;xml<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"><!--    配置处理器Handle，映射“firstController”-->
<pre><code>&lt;bean name=&quot;/firstController&quot; class=&quot;com.itzjc.controller.FirstController&quot;/&gt;
</code></pre>
<!--    处理器映射器，将处理器Handle的name作为url进行查找-->
<pre><code>&lt;bean class=&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;/&gt;
</code></pre>
<!--    处理器适配器，配置对处理器中handleRequest()方法的调用-->
<pre><code>&lt;bean class=&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;/&gt;
</code></pre>
<!--    视图解析器-->
<pre><code>&lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;/&gt;
</code></pre>
</beans>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 编写web容器类</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    public class FirstController implements Controller &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public ModelAndView handleRequest(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) throws Exception &#123;</span><br><span class="line">            //创建modeAndView</span><br><span class="line">            ModelAndView modelAndView = new ModelAndView();</span><br><span class="line">            //像模型对象增加数据</span><br><span class="line">            modelAndView.addObject(&quot;msg&quot;,&quot;我的第一个SpringMVC程序&quot;);</span><br><span class="line">            //设计逻辑试图</span><br><span class="line">            modelAndView.setViewName(&quot;/first.jsp&quot;);</span><br><span class="line">            //返回</span><br><span class="line">            return modelAndView;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>编写jsp</p>
<ul>
<li><pre><code class="jsp">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;charset=UTF-8&quot;&gt;
    &lt;title&gt;入门程序&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Hello $&#123;msg&#125;&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 10.3 springmvc工作流程</span><br><span class="line"></span><br><span class="line">![1650725442722](C:\Users\Administrator\Desktop\1650725442722.png)</span><br><span class="line"></span><br><span class="line">（1）用户通过浏览器向服务器发送请求，请求会被Spring MVC的前端控制器DispatcherServlet所拦截。</span><br><span class="line"></span><br><span class="line">（2）DispatcherServlet拦截到请求后，会调用HandlerMapping处理器映射器。</span><br><span class="line"></span><br><span class="line">（3）处理器映射器根据请求URL找到具体的处理器，生成处理器对象及处理器拦截器（如果有则生成）一并返回给DispatcherServlet。</span><br><span class="line"></span><br><span class="line">（4）DispatcherServlet会通过返回信息选择合适的HandlerAdapter（处理器适配器）。</span><br><span class="line"></span><br><span class="line">（5）HandlerAdapter会调用并执行Handler（处理器），这里的处理器指的就是程序中编写的Controller类，也被称之为后端控制器。</span><br><span class="line"></span><br><span class="line">（6）Controller执行完成后，会返回一个ModelAndView对象，该对象中会包含视图名或包含模型和视图名。</span><br><span class="line"></span><br><span class="line">（7）HandlerAdapter将ModelAndView对象返回给DispatcherServlet。</span><br><span class="line"></span><br><span class="line">（8）DispatcherServlet会根据ModelAndView对象选择一个合适的ViewReslover（视图解析器）。</span><br><span class="line"></span><br><span class="line">（9）ViewReslover解析后，会向DispatcherServlet中返回具体的View（视图）。</span><br><span class="line"></span><br><span class="line">（10）DispatcherServlet对View进行渲染（即将模型数据填充至视图中）。</span><br><span class="line"></span><br><span class="line">（11）视图渲染结果会返回给客户端浏览器显示。</span><br><span class="line"></span><br><span class="line"># 12.SpringMVC的核心类和注解</span><br><span class="line"></span><br><span class="line">学习目标</span><br><span class="line"></span><br><span class="line">● 了解Spring MVC核心类的作用</span><br><span class="line"></span><br><span class="line">● 掌握Spring MVC常用注解的使用</span><br><span class="line"></span><br><span class="line">## 12.1SpringMVC核心类和作用</span><br><span class="line"></span><br><span class="line">- DispatcherServlet</span><br><span class="line"></span><br><span class="line">## 12.2 常用注解</span><br><span class="line"></span><br><span class="line">- ```java</span><br><span class="line">  @Controller</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><pre><code class="xml">&lt;context:component-scan base-package=&quot;com.itzjc.controller&quot;/&gt;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- @RequestMapping</span><br><span class="line"></span><br><span class="line">  - Spring通过@Controller注解找到相应的控制器类后，还需要知道控制器内部对每一个请求是如何处理的，这就需要使用org.springframework.web.bind.annotation.RequestMapping注解类型。RequestMapping注解类型用于映射一个请求或一个方法,可以使用该注解标注在一个方法或一个类上。</span><br><span class="line"></span><br><span class="line">  - **1.标注在方法上**</span><br><span class="line"></span><br><span class="line">    - ```java</span><br><span class="line">      @Controller</span><br><span class="line">      public class FirstController &#123;</span><br><span class="line">          @RequestMapping(value = &quot;/firstController&quot;)</span><br><span class="line">          public ModelAndView handleRequest(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) throws Exception &#123;</span><br><span class="line">              //创建modeAndView</span><br><span class="line">              ModelAndView modelAndView = new ModelAndView();</span><br><span class="line">              //像模型对象增加数据</span><br><span class="line">              modelAndView.addObject(&quot;msg&quot;,&quot;我的第一个SpringMVC程序&quot;);</span><br><span class="line">              //设计逻辑试图</span><br><span class="line">              modelAndView.setViewName(&quot;/first.jsp&quot;);</span><br><span class="line">              //返回</span><br><span class="line">              return modelAndView;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

- 通localhost:8080/Spring07_MVC01**/firstController链接访问**
</code></pre>
</li>
<li><p><strong>2.标在类上</strong></p>
<ul>
<li><pre><code class="java">@Controller
@RequestMapping(&quot;/hello&quot;)
public class FirstController &#123;
    @RequestMapping(value = &quot;/firstController&quot;)
    public ModelAndView handleRequest(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) throws Exception &#123;
        //创建modeAndView
        ModelAndView modelAndView = new ModelAndView();
        //像模型对象增加数据
        modelAndView.addObject(&quot;msg&quot;,&quot;我的第一个SpringMVC程序&quot;);
        //设计逻辑试图
        modelAndView.setViewName(&quot;/first.jsp&quot;);
        //返回
        return modelAndView;
    &#125;
&#125;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - 访问路径**/hello/firstController**</span><br><span class="line"></span><br><span class="line">- **注解属性**</span><br><span class="line"></span><br><span class="line">  - ![1650812129267](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650812129267.png)</span><br><span class="line"></span><br><span class="line">- **组合注解**</span><br><span class="line"></span><br><span class="line">  - 需求：为了简化HTTP方法的映射</span><br><span class="line"></span><br><span class="line">  - **· @GetMapping：匹配GET方式的请求。**</span><br><span class="line"></span><br><span class="line">    - 等于</span><br><span class="line"></span><br><span class="line">    - ```java</span><br><span class="line">      @RequestMapping(value = &quot;/firstController&quot;,method = RequestMethod.GET)</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p><strong>· @PostMapping：匹配POST方式的请求。</strong></p>
</li>
<li><p><strong>· @PutMapping：匹配PUT方式的请求。</strong></p>
</li>
<li><p><strong>· @DeleteMapping：匹配DELETE方式的请求。</strong></p>
</li>
<li><p><strong>· @PatchMapping：匹配PATCH方式的请求。</strong></p>
</li>
</ul>
</li>
<li><p><strong>请求处理方法的参数类型和返回类型</strong></p>
<ul>
<li><p>如：HttpSession类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;firstController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">session01</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line">    ..</span><br><span class="line">    <span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>可以出现类型</p>
<ul>
<li>HttpServletRequest</li>
<li>HttpServletResponse</li>
<li>HttpSession</li>
<li>WebRequest或NativeWebRequest</li>
<li>java.util.Locale</li>
<li>java.util.TimeZone (Java 6+) &#x2F; java.time.ZoneId (onJava 8)</li>
<li>java.io.InputStream &#x2F; java.io.Reader</li>
<li>java.io.OutputStream &#x2F; java.io.Writer</li>
<li>org.springframework.http.HttpMethod</li>
<li>java.security.Principal</li>
<li>@PathVariable、@MatrixVariable、@RequestParam、@RequestHeader、@RequestBody、@RequestPart、@SessionAttribute、@RequestAttribute注解</li>
<li>HttpEntity&lt;? &gt;· java.util.Map &#x2F; org.springframework.ui.Model&#x2F;org.springframework.ui.ModelMap</li>
<li>org.springframework.web.servlet.mvc.support.RedirectAttributes</li>
<li>org.springframework.validation.Errors&#x2F;org.springframework.validation.BindingResult</li>
</ul>
</li>
<li><p>返回类型</p>
<ul>
<li>· ModelAndView· Model</li>
<li>· Map</li>
<li>· View</li>
<li>· String</li>
<li>· void</li>
<li>· HttpEntity&lt;? &gt;或ResponseEntity&lt;? &gt;</li>
<li>· Callable&lt;? &gt;</li>
<li>· DeferredResult&lt;? &gt;</li>
<li>其中ModelAndView类型中可以添加Model数据，并指定视图；</li>
<li>String类型的返回值可以跳转视图，但不能携带数据；</li>
<li>而void类型主要在异步请求时使用，它只返回数据，而不会跳转视图。</li>
</ul>
</li>
<li><p>重定向</p>
<ul>
<li><img src="C:\Users\Administrator\Desktop\1650813508076.png" alt="1650813508076"></li>
</ul>
</li>
<li><p>forward请求转发</p>
<ul>
<li><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650813548038.png" alt="1650813548038"></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="12-3-视图解析器"><a href="#12-3-视图解析器" class="headerlink" title="12.3 视图解析器"></a>12.3 视图解析器</h2><ul>
<li><p>Spring MVC中的视图解析器负责解析视图，可以通过在配置文件中定义一个ViewResolver来配置视图解析器</p>
<ul>
<li>&#96;&#96;&#96;xml<!--    定义视图解析器-->
<pre><code>&lt;bean id=&quot;viewResolver&quot; class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
</code></pre>
<!--        设置前缀-->
<pre><code>    &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;
</code></pre>
<!--        设置后缀-->
<pre><code>    &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;
&lt;/bean&gt;
</code></pre>
</beans>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - 这样设置后，方法中所定义的view路径将可以简化。例如，入门案例中的逻辑视图名只需设置为**“first”**，而不再需要设置为**“/WEB-INF/jsp/first.jsp”**</span><br><span class="line"></span><br><span class="line">## 12.4 基于注解的Spring MVC应用</span><br><span class="line"></span><br><span class="line">- 配置web.xml</span><br><span class="line"></span><br><span class="line">  - ```xml</span><br><span class="line">    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">    &lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span><br><span class="line">             xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">             xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span><br><span class="line">             version=&quot;4.0&quot;&gt;</span><br><span class="line">        &lt;servlet&gt;</span><br><span class="line">            &lt;!--        配置前端过滤器--&gt;</span><br><span class="line">            &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class="line">            &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</span><br><span class="line">            &lt;!--        初始化加载配置文件--&gt;</span><br><span class="line">            &lt;init-param&gt;</span><br><span class="line">                &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">                &lt;param-value&gt;classpath:springmvc_config.xml&lt;/param-value&gt;</span><br><span class="line">            &lt;/init-param&gt;</span><br><span class="line">            &lt;!--        表示容器在启动时立即加载的Servlet--&gt;</span><br><span class="line">            &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">        &lt;/servlet&gt;</span><br><span class="line">        &lt;servlet-mapping&gt;</span><br><span class="line">            &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class="line">            &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">        &lt;/servlet-mapping&gt;</span><br><span class="line">    &lt;/web-app&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>配置springmvc_config.xml</p>
<ul>
<li>&#96;&#96;&#96;xml<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xmlns:context="http://www.springframework.org/schema/context"
   xsi:schemaLocation="
   http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
   http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
"><br><!--扫包--><br>&lt;context:component-scan base-package&#x3D;”controller”&#x2F;&gt;<br><!--定义视图--><br><bean id="viewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver"><br>    <property name="prefix" value="/WEB-INF/jsp/"/><br>    <property name="suffix" value=".jsp"/><br></bean></beans>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 注解使用</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    @Controller</span><br><span class="line">    public class AController &#123;</span><br><span class="line">        @RequestMapping(&quot;/firstController&quot;)</span><br><span class="line">        public String handleRequest(HttpServletRequest httpServletRequest, HttpServletResponse response, Model model)&#123;</span><br><span class="line">            //向模型注入数据</span><br><span class="line">            model.addAttribute(&quot;msg&quot;,&quot;HE&quot;);</span><br><span class="line">            //返回页面</span><br><span class="line">            return &quot;first&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>jsp地址</p>
<ul>
<li><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650816641747.png" alt="1650816641747"></li>
</ul>
</li>
</ul>
<h1 id="13-数据绑定"><a href="#13-数据绑定" class="headerlink" title="13.数据绑定"></a>13.数据绑定</h1><p>学习目标</p>
<p>● 了解Spring MVC中的数据绑定的概念</p>
<p>● 熟悉Spring MVC中的几种数据绑定类型</p>
<p>● 掌握Spring MVC数据绑定的使用</p>
<p>在实际的项目开发中，多数情况下客户端会传递带有不同参数的请求，那么后台是如何绑定并获取这些请求参数的呢</p>
<h2 id="13-1-概念"><a href="#13-1-概念" class="headerlink" title="13.1 概念"></a>13.1 概念</h2><ul>
<li><strong>概念：</strong>在执行程序时，Spring MVC会根据<strong>客户端</strong>请求参数的不同，将请求消息中的信息以一定的<strong>方式转换</strong>并绑定到<strong>控制器类</strong>的方法参数中。这种将<strong>请求消息数据</strong>与<strong>后台方法参数</strong>建立连接的过程就是Spring MVC中的数据绑定。</li>
<li><strong>DataBinder</strong><ul>
<li><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650897309775.png" alt="1650897309775"></li>
</ul>
</li>
<li><strong>信息处理步骤</strong><ul>
<li>（1）Spring MVC将ServletRequest对象传递给DataBinder。</li>
<li>（2）将处理方法的入参对象传递给DataBinder。</li>
<li>（3）DataBinder调用ConversionService组件进行数据类型转换、数据格式化等工作，并将ServletRequest对象中的消息填充到参数对象中。</li>
<li>（4）调用Validator组件对已经绑定了请求消息数据的参数对象进行数据合法性校验。</li>
<li>（5）校验完成后会生成数据绑定结果BindingResult对象，Spring MVC会将BindingResult对象中的内容赋给处理方法的相应参数。</li>
</ul>
</li>
<li>根据客户端请求参数类型和个数的不同，我们将Spring MVC中的数据绑定主要分为<strong>简单数据绑定</strong>和<strong>复杂数据绑定</strong></li>
</ul>
<h2 id="13-2-简单数据绑定"><a href="#13-2-简单数据绑定" class="headerlink" title="13.2 简单数据绑定"></a>13.2 简单数据绑定</h2><ul>
<li><p>绑定默认数据类型</p>
<ul>
<li><p>当前端请求的<strong>参数比较简单</strong>时，可以在后台方法的形参中直接使用Spring MVC提供的默认参数类型进行数据绑定。</p>
</li>
<li><p>常用的默认参数类型</p>
<ul>
<li>· HttpServletRequest：通过request对象获取请求信息。</li>
<li>· HttpServletResponse：通过response处理响应信息。</li>
<li>· HttpSession：通过session对象得到session中存储的对象。</li>
<li>· Model&#x2F;ModelMap:Model是一个接口，ModelMap是一个接口实现，作用是将model数据填充到request域。</li>
</ul>
</li>
<li><p><strong>例子</strong></p>
<ul>
<li><p>导坐标，配置web.xml，定义页面</p>
</li>
<li><p>创建用户操作控制器</p>
<ul>
<li>&#96;&#96;&#96;java<br>@Controller<br>public class AController {<br>@RequestMapping(“&#x2F;selectUser”)<br>public String selectUser(HttpServletRequest request){<br>    String id &#x3D; request.getParameter(“id”);<br>    System.out.println(“id&#x3D;” + id);<br>    return “success”;<br>}<br>}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- jsp页面</span><br><span class="line"></span><br><span class="line">  - ```jsp</span><br><span class="line">    &lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line">    &lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;页面结果&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">    9 ok</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">    &lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>请求url<a target="_blank" rel="noopener" href="http://localhost:8080/spring08_demo/selectUser?id=1">http://localhost:8080/spring08_demo/selectUser?id=1</a></p>
</li>
<li><p>输出结果</p>
<ul>
<li><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650899367259.png" alt="1650899367259"></li>
<li><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650899383818.png" alt="1650899383818"></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>绑定简单数据类型</p>
<ul>
<li><p><strong>简单数据类型：</strong>int、String、Double等类型。</p>
</li>
<li><p>例子：</p>
<ul>
<li><p>修改控制器</p>
<ul>
<li>&#96;&#96;&#96;java<br>@RequestMapping(“&#x2F;selectUser”)<br>public String selectUser(Integer id){<br>System.out.println(“id&#x3D;” + id);<br>return “success”;<br>}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 输出结果与上例一样</span><br><span class="line"></span><br><span class="line">- **@RequestParam**：当前端请求中**参数名**和**后台控制器类方法**中的**形参名**不一样</span><br><span class="line"></span><br><span class="line">  - ![1650899802981](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650899802981.png)</span><br><span class="line"></span><br><span class="line">  - 将前端输入User_id映射到id</span><br><span class="line"></span><br><span class="line">    ```java</span><br><span class="line">    @RequestMapping(&quot;/selectUser&quot;)</span><br><span class="line">    public String selectUser(@RequestParam(value = &quot;user_id&quot;) Integer id)&#123;</span><br><span class="line">        System.out.println(&quot;id=&quot; + id);</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>绑定pojo类型</p>
<ul>
<li><p>当传的参数过多时，用pojo</p>
</li>
<li><p>例子</p>
<ul>
<li><p>1.定义pojo类</p>
<ul>
<li>&#96;&#96;&#96;java<br>public class User {<br>private Integer id;<br>private String username;<br>private Integer password;<br><br>public Integer getId() {<br>    return id;<br>}<br><br>public void setId(Integer id) {<br>    this.id &#x3D; id;<br>}<br><br>public String getUsername() {<br>    return username;<br>}<br><br>public void setUsername(String username) {<br>    this.username &#x3D; username;<br>}<br><br>public Integer getPassword() {<br>    return password;<br>}<br><br>public void setPassword(Integer password) {<br>    this.password &#x3D; password;<br>}<br><br>@Override<br>public String toString() {<br>    return “User{“ +<br>            “id&#x3D;” + id +<br>            “, username&#x3D;’” + username + ‘&#39;‘ +<br>            “, password&#x3D;” + password +<br>            ‘}’;<br>}<br>}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 2.写Controller</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    @RequestMapping(&quot;/registerUser&quot;)</span><br><span class="line">    public String registerUser(User user)&#123;</span><br><span class="line">        String username = user.getUsername();</span><br><span class="line">        Integer password = user.getPassword();</span><br><span class="line">        System.out.println(&quot;username=&quot; + username);</span><br><span class="line">        System.out.println(&quot;password=&quot; + password);</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>3.jsp</p>
</li>
<li><pre><code class="jsp">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;注册&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;form action=&quot;$&#123;pageContext.request.contextPath&#125;/registerUser&quot; method=&quot;post&quot;&gt;
用户名:&lt;input type=&quot;text&quot; name=&quot;username&quot;/&gt;&lt;br/&gt;
密码:&lt;input type=&quot;password&quot; name=&quot;password&quot;/&gt;&lt;br/&gt;
&lt;input type=&quot;submit&quot; value=&quot;注册&quot;/&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- **注意：**在使用POJO类型数据绑定时，前端请求的参数名（本例中指form表单内各元素的name属性值）必须与要绑定的POJO类中的属性名一样，这样才会自动将请求数据绑定到POJO对象中，否则后台接收的参数值为null。</span><br><span class="line"></span><br><span class="line">- 请求乱码处理</span><br><span class="line"></span><br><span class="line">  - 编码过滤器来统一编码</span><br><span class="line"></span><br><span class="line">  - web.xml</span><br><span class="line"></span><br><span class="line">    ```xml</span><br><span class="line">    &lt;!--    编码过滤器--&gt;</span><br><span class="line">        &lt;filter&gt;</span><br><span class="line">            &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;</span><br><span class="line">            &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;</span><br><span class="line">            &lt;init-param&gt;</span><br><span class="line">                &lt;param-name&gt;encoding&lt;/param-name&gt;</span><br><span class="line">                &lt;param-value&gt;UTF-8&lt;/param-value&gt;</span><br><span class="line">            &lt;/init-param&gt;</span><br><span class="line">        &lt;/filter&gt;</span><br><span class="line">        &lt;filter-mapping&gt;</span><br><span class="line">            &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;</span><br><span class="line">            &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span><br><span class="line">        &lt;/filter-mapping&gt;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>BUG</p>
</li>
<li><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650975003812.png" alt="1650975003812"></p>
</li>
<li><p>加上</p>
</li>
<li><pre><code class="jsp">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;charset=UTF-8&quot;&gt;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 绑定包装pojo</span><br><span class="line"></span><br><span class="line">  - 例子</span><br><span class="line"></span><br><span class="line">    - ```java</span><br><span class="line">      public class Orders &#123;</span><br><span class="line">          private Integer ordersId;</span><br><span class="line">          private User user;</span><br><span class="line">      </span><br><span class="line">          public Integer getOrdersId() &#123;</span><br><span class="line">              return ordersId;</span><br><span class="line">          &#125;</span><br><span class="line">      </span><br><span class="line">          public void setOrdersId(Integer ordersId) &#123;</span><br><span class="line">              this.ordersId = ordersId;</span><br><span class="line">          &#125;</span><br><span class="line">      </span><br><span class="line">          public User getUser() &#123;</span><br><span class="line">              return user;</span><br><span class="line">          &#125;</span><br><span class="line">      </span><br><span class="line">          public void setUser(User user) &#123;</span><br><span class="line">              this.user = user;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>注入[类变量名.变量]方法给user对象赋值</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span></span><br><span class="line"><span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html;charset=UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;注册&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/findOrdersWithUser&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    ordersId     &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;ordersId&quot;</span>/&gt;&lt;br/&gt;</span><br><span class="line">    user.id&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;user.id&quot;</span>/&gt;&lt;br/&gt;</span><br><span class="line">    user.username&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;user.username&quot;</span>/&gt;&lt;br/&gt;</span><br><span class="line">    user.password&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;user.password&quot;</span>/&gt;&lt;br/&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span>/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>**注意:**在使用包装POJO类型数据绑定时，前端请求的参数名编写必须符合以下两种情况。</p>
</li>
<li><p>① 如果查询条件参数是包装类的直接<strong>基本属性</strong>，则参数名<strong>直接用对应的属性名</strong>，如上面代码中的<strong>ordersId</strong>。</p>
</li>
<li><p>② 如果查询条件参数是包装类中<strong>POJO的子属性</strong>，则参数名必须为<strong>【对象．属性】</strong>，其中【对象】要和包装POJO中的<strong>对象属性名称一致</strong>，【属性】要和包装POJO中的对象子属性一致，如上述代码中的<strong>user.username</strong>。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>自定义属性绑定</strong></p>
<ul>
<li><p><strong>需求：</strong>有些<strong>特殊类型的参数</strong>是无法在后台进行直接转换的，例如<strong>日期数据</strong>就需要开发者自定义转换器（<strong>Converter</strong>）或格式化（<strong>Formatter</strong>）来进行数据绑定。</p>
</li>
<li><p><strong>Converter</strong>:如将日期形式的字符串转化为日期类型</p>
<ul>
<li><p>1.转化类</p>
<ul>
<li><p>&#96;&#96;&#96;java<br>package com.itzjc.convert;</p>
<p>import org.springframework.core.convert.converter.Converter;</p>
<p>import java.text.ParseException;<br>import java.text.SimpleDateFormat;<br>import java.util.Date;</p>
<p>&#x2F;**</p>
<ul>
<li><p>自定义日期转换器<br> *&#x2F;<br>public class DateConverter implements Converter&lt;String,Date&gt; {<br> &#x2F;&#x2F;定义日期格式<br> private String dataPatten &#x3D; “yyyy-MM-dd HH:mm:ss”;</p>
<p> @Override<br> public Date convert(String source) {<br> &#x2F;&#x2F;格式化日期<br> SimpleDateFormat sdf &#x3D; new SimpleDateFormat(dataPatten);<br> try {<br>     return sdf.parse(source);<br> } catch (ParseException e) {<br>     throw new IllegalArgumentException(“无效的日期格式，请使用这种格式:”+dataPatten);<br> }<br> }</p>
</li>
</ul>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 配置id为conversionService的bean</span><br><span class="line"></span><br><span class="line">  - ```xml</span><br><span class="line">    &lt;!--显示装配自定义转换器--&gt;</span><br><span class="line">    &lt;mvc:annotation-driven conversion-service=&quot;conversionService&quot;/&gt;</span><br><span class="line">    &lt;!--自定义类型转换器配置--&gt;</span><br><span class="line">    &lt;bean id=&quot;conversionService&quot; class=&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;converters&quot;&gt;</span><br><span class="line">            &lt;set&gt;</span><br><span class="line">                &lt;bean class=&quot;com.itzjc.convert.DateConverter&quot;/&gt;</span><br><span class="line">            &lt;/set&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>容器使用</p>
<ul>
<li>&#96;&#96;&#96;java<br>@RequestMapping(“&#x2F;customDate”)<br>public String CustomDate(Date date){<br>System.out.println(“data&#x3D;” + date);<br>return “success”;<br>}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - 结果：</span><br><span class="line"></span><br><span class="line">    - 输入：http://localhost:8080/spring08_demo/customDate?date= 2017-04-12 15:55:55</span><br><span class="line"></span><br><span class="line">    - 输出：</span><br><span class="line"></span><br><span class="line">      ![1650979531192](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650979531192.png)</span><br><span class="line"></span><br><span class="line">- **Formatter**：和Converter一样，只是**Formatter**的源类型**必须**是一个**String类型**，而**Converter**可以是**任意类型**。</span><br><span class="line"></span><br><span class="line">  - 转换器类</span><br><span class="line"></span><br><span class="line">    ```java</span><br><span class="line">    package com.itzjc.convert;</span><br><span class="line">    </span><br><span class="line">    import org.springframework.core.convert.converter.Converter;</span><br><span class="line">    import org.springframework.format.Formatter;</span><br><span class="line">    </span><br><span class="line">    import java.text.ParseException;</span><br><span class="line">    import java.text.SimpleDateFormat;</span><br><span class="line">    import java.util.Date;</span><br><span class="line">    import java.util.Locale;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 自定义日期转换器</span><br><span class="line">     */</span><br><span class="line">    public class DateFormatter implements Formatter&lt;Date&gt; &#123;</span><br><span class="line">        //定义日期格式</span><br><span class="line">        private String dataPatten = &quot;yyyy-MM-dd HH:mm:ss&quot;;</span><br><span class="line">        //声明SimpleDateFormat</span><br><span class="line">        private SimpleDateFormat simpleDateFormat;</span><br><span class="line">        //转化类型</span><br><span class="line">        @Override</span><br><span class="line">        public Date parse(String source, Locale locale) throws ParseException &#123;</span><br><span class="line">            simpleDateFormat = new SimpleDateFormat(dataPatten);</span><br><span class="line">            return simpleDateFormat.parse(source);</span><br><span class="line">        &#125;</span><br><span class="line">        //返回目标对象的字符串</span><br><span class="line">        @Override</span><br><span class="line">        public String print(Date date, Locale locale) &#123;</span><br><span class="line">            return new SimpleDateFormat().format(date);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Spring配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--显示装配自定义转换器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">&quot;conversionService&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--自定义类型转换器配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;conversionService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;formatters&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.itzjc.convert.DateFormatter&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>实现效果与Converter一致</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="13-3-复杂数据绑定"><a href="#13-3-复杂数据绑定" class="headerlink" title="13.3 复杂数据绑定"></a>13.3 复杂数据绑定</h2><p><strong>复杂数据绑定：</strong>数组绑定和集合绑定的使用。</p>
<ul>
<li><p><strong>数组</strong></p>
<ul>
<li><p>控制器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/toUser&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toUser</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;user&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/deleteUsers&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">deleteUsers</span><span class="params">(Integer[] ids)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ids != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (Integer id : ids) &#123;</span><br><span class="line">            <span class="comment">//使用输出语句模拟已删除用户</span></span><br><span class="line">            System.out.println(<span class="string">&quot;删除了id为&quot;</span> + id + <span class="string">&quot;的用户！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ids=null&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html;charset=UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;注册&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/deleteUsers&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">&lt;table width=<span class="string">&quot;20%&quot;</span> border=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;选择&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;用户名&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;&lt;input name=<span class="string">&quot;ids&quot;</span> value=<span class="string">&quot;1&quot;</span> type=<span class="string">&quot;checkbox&quot;</span>/&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;tom&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;&lt;input name=<span class="string">&quot;ids&quot;</span> value=<span class="string">&quot;2&quot;</span> type=<span class="string">&quot;checkbox&quot;</span>/&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;jack&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;&lt;input name=<span class="string">&quot;ids&quot;</span> value=<span class="string">&quot;3&quot;</span> type=<span class="string">&quot;checkbox&quot;</span>/&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;lucy&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span>/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650985358257.png" alt="1650985358257"></p>
</li>
</ul>
</li>
<li><p><strong>集合</strong></p>
<ul>
<li><p>定义包装类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itzjc.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itzjc.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserVo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;User&gt; users;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsers</span><span class="params">(List&lt;User&gt; users)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.users = users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>控制器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/toUserEdit&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toUserEdit</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;user_edit&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/editUsers&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">editUsers</span><span class="params">(UserVo userList)</span>&#123;</span><br><span class="line">    List&lt;User&gt; users = userList.getUsers();</span><br><span class="line">    <span class="comment">//遍历集合</span></span><br><span class="line">    <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">        <span class="comment">//如果接收id不为空，则接收</span></span><br><span class="line">        <span class="keyword">if</span> (user.getId() != <span class="literal">null</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;修改id为&quot;</span> + user.getId() + <span class="string">&quot;的用户名为：&quot;</span> + user.getUsername());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>**注意:**在使用集合数据绑定时，后台方法中不支持直接使用集合形参进行数据绑定，所以需要使用包装POJO作为形参，然后在包装POJO中包装一个集合属性。</p>
</li>
<li><p>jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html;charset=UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;注册&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/deleteUsers&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">&lt;table width=<span class="string">&quot;20%&quot;</span> border=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;选择&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;用户名&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;&lt;input name=<span class="string">&quot;users[0].id&quot;</span> value=<span class="string">&quot;1&quot;</span> type=<span class="string">&quot;checkbox&quot;</span>/&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;input name=<span class="string">&quot;users[0].username&quot;</span> value=<span class="string">&quot;tom&quot;</span> type=<span class="string">&quot;text&quot;</span>/&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;&lt;input name=<span class="string">&quot;users[1].id&quot;</span> value=<span class="string">&quot;2&quot;</span> type=<span class="string">&quot;checkbox&quot;</span>/&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;input name=<span class="string">&quot;users[1].username&quot;</span> value=<span class="string">&quot;jack&quot;</span> type=<span class="string">&quot;text&quot;</span>/&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;&lt;input name=<span class="string">&quot;users[2].id&quot;</span> value=<span class="string">&quot;3&quot;</span> type=<span class="string">&quot;checkbox&quot;</span>/&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;input name=<span class="string">&quot;users[2].username&quot;</span> value=<span class="string">&quot;lucy&quot;</span> type=<span class="string">&quot;text&quot;</span>/&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span>/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>输出结果</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1650986449900.png" alt="1650986449900"></p>
</li>
</ul>
</li>
</ul>
<h1 id="14-JSON数据交互和RESTful支持"><a href="#14-JSON数据交互和RESTful支持" class="headerlink" title="14.JSON数据交互和RESTful支持"></a>14.JSON数据交互和RESTful支持</h1><p>学习目标</p>
<p>● 了解JSON的数据结构</p>
<p>● 掌握Spring MVC中JSON数据交互的使用</p>
<p>● 熟悉RESTful风格的请求样式</p>
<p>● 掌握Spring MVC中RESTful风格请求的使用</p>
<h2 id="14-1-JSON数据结构"><a href="#14-1-JSON数据结构" class="headerlink" title="14.1 JSON数据结构"></a>14.1 JSON数据结构</h2><ul>
<li><p>与XML一样，JSON也是基于纯文本的数据格式。</p>
</li>
<li><p>JSON数据的两种数据结构</p>
<ul>
<li><p>对象结构</p>
<ul>
<li><p>对象结构以“{”开始，以“}”结束。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	key1<span class="punctuation">:</span>value1<span class="punctuation">,</span></span><br><span class="line">	key2<span class="punctuation">:</span>value2<span class="punctuation">,</span></span><br><span class="line">	...</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>其中key必须为String类型</p>
</li>
<li><p>其中value可以为String、Number、Object、Array等数据类型。</p>
</li>
</ul>
</li>
<li><p>数组结构</p>
<ul>
<li><p>数组结构以“[”开始，以“]”结束。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">	value1<span class="punctuation">,</span></span><br><span class="line">	value2<span class="punctuation">,</span></span><br><span class="line">	...</span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>其中value1与value2可以为不同类型</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="string">&quot;abc&quot;</span><span class="punctuation">,</span><span class="number">123</span><span class="punctuation">,</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>对象结构可嵌入数组结构,也可嵌入对象结构</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;zhangsan&quot;</span></span><br><span class="line">	<span class="attr">&quot;hobby&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;篮球&quot;</span><span class="punctuation">,</span><span class="string">&quot;羽毛球&quot;</span><span class="punctuation">,</span><span class="string">&quot;游泳&quot;</span><span class="punctuation">]</span></span><br><span class="line">	<span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;city&quot;</span><span class="punctuation">:</span><span class="string">&quot;Beijing&quot;</span></span><br><span class="line">		<span class="attr">&quot;street&quot;</span><span class="punctuation">:</span><span class="string">&quot;Xisanqi&quot;</span></span><br><span class="line">		<span class="attr">&quot;postcode&quot;</span><span class="punctuation">:</span><span class="number">100096</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="14-2-SpringMVC中JSON数据使用"><a href="#14-2-SpringMVC中JSON数据使用" class="headerlink" title="14.2 SpringMVC中JSON数据使用"></a>14.2 SpringMVC中JSON数据使用</h2><ul>
<li><p>HttpMessageConverter<T>:将请求数据转化为T类；</p>
</li>
<li><p>JSON开源包</p>
<ul>
<li>**· jackson-annoations-2.8.8.jar:**JSON转换注解包。</li>
<li>**· jackson-core-2.8.8.jar:**JSON转换核心包。</li>
<li>**· jackson-databind-2.8.8.jar:**JSON转换的数据绑定包。</li>
</ul>
</li>
<li><p>两个重要注解</p>
<ul>
<li>@RequestBody:将请求体数据绑定到方法形参中；</li>
<li>@ResponseBody：直接返回return对象</li>
</ul>
</li>
<li><p>实现步骤：</p>
<ul>
<li>&#96;&#96;&#96;java<br>@RequestMapping(“&#x2F;test1”)<br>@ResponseBody<br>public String test1(@RequestBody User user){<br>&#x2F;&#x2F;打印JSON数据<br>System.out.println(user);<br>&#x2F;&#x2F;返回JSON格式响应<br>String userString &#x3D; JSON.toJSONString(user);<br>return userString;<br>}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">- **静态资源访问**:</span><br><span class="line"></span><br><span class="line">  - **&lt;mvc:resources… /&gt;**</span><br><span class="line"></span><br><span class="line">    ![1651136330092](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1651136330092.png)</span><br><span class="line"></span><br><span class="line">  - **&lt;mvc:default-servlet-handler /&gt;**</span><br><span class="line"></span><br><span class="line">    - 它会像一个检查员，对进入DispatcherServlet的URL进行筛查。如果发现是静态资源的请求，就将该请求转由Web服务器默认的Servlet处理，默认的Servlet就会对这些静态资源放行；如果不是静态资源的请求，才由DispatcherServlet继续处理。</span><br><span class="line"></span><br><span class="line">    - **注意：**</span><br><span class="line"></span><br><span class="line">      一般Web服务器默认的Servlet名称是&quot;default&quot;，因此DefaultServletHttpRequestHandler可以找到它。如果使用的Web应用服务器默认的Servlet名称不是&quot;default&quot;。</span><br><span class="line"></span><br><span class="line">      ![1651137477225](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1651137477225.png)</span><br><span class="line"></span><br><span class="line">      - 而Web服务器的Servlet名称是由使用的服务器确定的，常用服务器及其Servlet名称如下。</span><br><span class="line">      - · Tomcat、Jetty、JBoss和and GlassFish默认Servlet的名称——&quot;default&quot;。</span><br><span class="line">      - · Google App Engine默认Servlet的名称——&quot;_ah_default&quot;。</span><br><span class="line">      - · Resin默认Servlet的名称——&quot;resin-file&quot;。</span><br><span class="line">      - · WebLogic默认Servlet的名称——&quot;FileServlet&quot;。</span><br><span class="line">      - · WebSphere默认Servlet的名称——&quot;SimpleFileServlet&quot;。</span><br><span class="line"></span><br><span class="line">    - **激活Tomcat默认的Servlet来处理静态文件访问。**</span><br><span class="line"></span><br><span class="line">      - ```xml</span><br><span class="line">        &lt;servlet-mapping&gt;</span><br><span class="line">            &lt;servlet-name&gt;default&lt;/servlet-name&gt;</span><br><span class="line">            &lt;url-pattern&gt;*.js&lt;/url-pattern&gt;</span><br><span class="line">        &lt;/servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-mapping&gt;</span><br><span class="line">            &lt;servlet-name&gt;default&lt;/servlet-name&gt;</span><br><span class="line">            &lt;url-pattern&gt;*.css&lt;/url-pattern&gt;</span><br><span class="line">        &lt;/servlet-mapping&gt;</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>

<ul>
<li><p>以上3种静态资源访问的配置方式不同，并且各有优缺点，具体如下。</p>
<ul>
<li>· 第一和第三种配置方式可以选择性的释放静态资源。</li>
<li>· 第二种配置方式配置相对简单，只需要一行代码，就可以释放所有静态资源。</li>
<li>· 第二和第三种配置方式会导致项目移植性较差，需要根据具体的Web服务器来更改Servlet名称。</li>
<li>· 第三种配置方式运行效率更高，因为服务器启动时已经加载了web.xml中的静态资源。</li>
<li>在实际开发中，更为常用的配置还是第一种（即案例中的）配置方式，这样就不需要考虑Web服务器的问题了。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="14-3-RESTful支持"><a href="#14-3-RESTful支持" class="headerlink" title="14.3 RESTful支持"></a>14.3 RESTful支持</h2><p>RESTful风格就是把请求参数变成请求路径的一种风格。</p>
<ul>
<li><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1651157944711.png" alt="1651157944711"></li>
<li>UserController</li>
<li><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1651158033955.png" alt="1651158033955"></li>
<li>在上述代码中，@RequestMapping(value&#x3D;”&#x2F;user&#x2F;{id}”,method&#x3D;RequestMethod.GET)注解用于匹配请求路径（包括参数）和方式。其中value&#x3D;”&#x2F;user&#x2F;{id}”表示可以匹配以“&#x2F;user&#x2F;{id}”结尾的请求，id为请求中的动态参数；method&#x3D;RequestMethod.GET表示只接收GET方式的请求。方法中的@PathVariable(“id”)注解则用于接收并绑定请求参数，它可以将请求URL中的变量映射到方法的形参上，如果请求路径为“&#x2F;user&#x2F;{id}”，即请求参数中的id和方法形参名称id一样，则@PathVariable后面的“(“id”)”可以省略。</li>
</ul>
<h1 id="15-拦截器"><a href="#15-拦截器" class="headerlink" title="15.拦截器"></a>15.拦截器</h1><p>学习目标</p>
<p>● 了解拦截器定义和配置方式</p>
<p>● 熟悉拦截器的执行流程</p>
<p>● 掌握拦截器的使用</p>
<h2 id="15-1-拦截器的定义和配置方式"><a href="#15-1-拦截器的定义和配置方式" class="headerlink" title="15.1 拦截器的定义和配置方式"></a>15.1 拦截器的定义和配置方式</h2><p><strong>概念：</strong>Spring MVC中的拦截器（Interceptor）类似于Servlet中的过滤器（Filter），它主要用于拦截用户请求并做相应的处理。例如通过拦截器可以进行权限验证、记录请求信息的日志、判断用户是否登录等。</p>
<ul>
<li><p>拦截器使用</p>
<ul>
<li><p>1.定义拦截器</p>
<ul>
<li><p>一种是通过实现<strong>HandlerInterceptor接口</strong>，或继承<strong>HandlerInterceptor接口的实现类</strong>（如HandlerInterceptorAdapter）来定义；</p>
</li>
<li><p>另一种是通过实现<strong>WebRequestInterceptor接口</strong>，或继承<strong>WebRequestInterceptor接口的实现类</strong>来定义。</p>
</li>
<li><p>例子：使用HandlerInterceptor接口实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itzjc.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="comment">//执行时机：在控制器方法前执行</span></span><br><span class="line">    <span class="comment">//返回值：false:会中断后续的所有操作</span></span><br><span class="line">    <span class="comment">//       true:表示继续向下执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//执行时机：控制器方法调用之后，且解析视图之前执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//执行时机：整个请求完成，即视图渲染结束之后执行。</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>2.拦截器配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置拦截器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用bean直接定义在&lt;mvc:interceptors&gt;下面的Interceptor将拦截所有的请求--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.itzjc.interceptor.CustomInterceptor&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--拦截器1--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置拦截器作用的路径--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置不需要拦截器作用的路径--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--定义在&lt;mvc:interceptor&gt;下面的，表示对匹配路径的请求才进行拦截--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.itzjc.interceptor.Interceptor1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--拦截器2--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/hello&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.itzjc.interceptor.Interceptor2&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>&lt;mvc:interceptor &gt;之上</strong>的bean为<strong>全局拦截器</strong></li>
<li><strong>&lt;mvc:interceptor &gt;：</strong>定义指定的拦截器<ul>
<li>子元素**<a href="mvc:mapping**">mvc:mapping**</a>path属性：配置拦截器作用的路径<ul>
<li>&#x2F;**：表示拦截所有路径</li>
<li>&#x2F;hello：拦截以hello结尾的路径</li>
</ul>
</li>
<li>子元素**&lt;mvc:exclude-mapping &gt;**path属性：配置不需要拦截的路径</li>
</ul>
</li>
<li>书写顺序：&lt;mvc:mapping …&#x2F;&gt;→&lt;mvc:exclude-mapping … &#x2F;&gt;→&lt;bean … &#x2F;&gt;</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="15-2-执行流程"><a href="#15-2-执行流程" class="headerlink" title="15.2 执行流程"></a>15.2 执行流程</h2><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1651325994145.png" alt="1651325994145"></p>
<ul>
<li><p>1.书写拦截器</p>
<ul>
<li><p>&#96;&#96;&#96;java<br>package com.itzjc.interceptor;</p>
<p>import org.springframework.web.servlet.HandlerInterceptor;<br>import org.springframework.web.servlet.ModelAndView;</p>
<p>import javax.servlet.http.HttpServletRequest;<br>import javax.servlet.http.HttpServletResponse;</p>
<p>public class CustomInterceptor implements HandlerInterceptor {<br>@Override<br>public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {<br>    System.out.println(“CustomInterceptor…preHandle”);<br>    return true;<br>}<br><br>@Override<br>public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {<br>    System.out.println(“CustomInterceptor…postHandle”);<br>}<br><br>@Override<br>public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {<br>    System.out.println(“CustomInterceptor…afterCompletion”);<br>}<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 2.配置拦截器</span><br><span class="line"></span><br><span class="line">  - ```xml</span><br><span class="line">    &lt;mvc:interceptors&gt;</span><br><span class="line">        &lt;!--定义全局拦截器--&gt;</span><br><span class="line">        &lt;bean class=&quot;com.itzjc.interceptor.CustomInterceptor&quot;/&gt;</span><br><span class="line">    &lt;/mvc:interceptors&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>3.定义容器</p>
<ul>
<li><pre><code class="java">package com.itzjc.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class HelloController &#123;
    /**
     * 页面跳转
     */
    @RequestMapping(&quot;/hello&quot;)
    public String hello()&#123;
        System.out.println(&quot;Hello!&quot;);
        return &quot;user&quot;;
    &#125;
&#125;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 4.输出结果</span><br><span class="line"></span><br><span class="line">  - ![1651329757954](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1651329757954.png)</span><br><span class="line"></span><br><span class="line">## 15.3 多个拦截器执行流程</span><br><span class="line"></span><br><span class="line">![1651331007829](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1651331007829.png)</span><br><span class="line"></span><br><span class="line">- 1.定义拦截器</span><br><span class="line"></span><br><span class="line">  - 拦截器1</span><br><span class="line"></span><br><span class="line">    - ```java</span><br><span class="line">      package com.itzjc.interceptor;</span><br><span class="line">      </span><br><span class="line">      import org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line">      import org.springframework.web.servlet.ModelAndView;</span><br><span class="line">      </span><br><span class="line">      import javax.servlet.http.HttpServletRequest;</span><br><span class="line">      import javax.servlet.http.HttpServletResponse;</span><br><span class="line">      </span><br><span class="line">      public class Interceptor1 implements HandlerInterceptor &#123;</span><br><span class="line">          @Override</span><br><span class="line">          public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123;</span><br><span class="line">              System.out.println(&quot;Interceptor1...preHandle&quot;);</span><br><span class="line">              return true;</span><br><span class="line">          &#125;</span><br><span class="line">      </span><br><span class="line">          @Override</span><br><span class="line">          public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123;</span><br><span class="line">              System.out.println(&quot;Interceptor1...postHandle&quot;);</span><br><span class="line">          &#125;</span><br><span class="line">      </span><br><span class="line">          @Override</span><br><span class="line">          public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123;</span><br><span class="line">              System.out.println(&quot;Interceptor1...afterCompletion&quot;);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>拦截器2</p>
<ul>
<li><p>&#96;&#96;&#96;java<br>package com.itzjc.interceptor;</p>
<p>import org.springframework.web.servlet.HandlerInterceptor;<br>import org.springframework.web.servlet.ModelAndView;</p>
<p>import javax.servlet.http.HttpServletRequest;<br>import javax.servlet.http.HttpServletResponse;</p>
<p>public class Interceptor2 implements HandlerInterceptor {<br>@Override<br>public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {<br>    System.out.println(“Interceptor2…preHandle”);<br>    return true;<br>}<br><br>@Override<br>public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {<br>    System.out.println(“Interceptor2…postHandle”);<br>}<br><br>@Override<br>public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {<br>    System.out.println(“Interceptor2…afterCompletion”);<br>}<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 2.配置拦截器</span><br><span class="line"></span><br><span class="line">  - ```xml</span><br><span class="line">    &lt;mvc:interceptors&gt;</span><br><span class="line">        &lt;!--拦截器1--&gt;</span><br><span class="line">        &lt;mvc:interceptor&gt;</span><br><span class="line">            &lt;mvc:mapping path=&quot;/**&quot;/&gt;</span><br><span class="line">            &lt;bean class=&quot;com.itzjc.interceptor.Interceptor1&quot;/&gt;</span><br><span class="line">        &lt;/mvc:interceptor&gt;</span><br><span class="line">        &lt;!--拦截器2--&gt;</span><br><span class="line">        &lt;mvc:interceptor&gt;</span><br><span class="line">            &lt;mvc:mapping path=&quot;/hello&quot;/&gt;</span><br><span class="line">            &lt;bean class=&quot;com.itzjc.interceptor.Interceptor2&quot;/&gt;</span><br><span class="line">        &lt;/mvc:interceptor&gt;</span><br><span class="line">    &lt;/mvc:interceptors&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>3.定义容器</p>
<ul>
<li><p>&#96;&#96;&#96;java<br>package com.itzjc.controller;</p>
<p>import org.springframework.stereotype.Controller;<br>import org.springframework.web.bind.annotation.RequestMapping;</p>
<p>@Controller<br>public class HelloController {<br>&#x2F;**<br> * 页面跳转<br> *&#x2F;<br>@RequestMapping(“&#x2F;hello”)<br>public String hello(){<br>    System.out.println(“Hello!”);<br>    return “user”;<br>}<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 4.测试</span><br><span class="line"></span><br><span class="line">  - ![1651332125229](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1651332125229.png)</span><br><span class="line"></span><br><span class="line"># 16.文件上传和下载</span><br><span class="line"></span><br><span class="line">学习目标</span><br><span class="line"></span><br><span class="line">● 熟悉Spring MVC中文件上传的实现步骤</span><br><span class="line"></span><br><span class="line">● 掌握文件上传案例的编写</span><br><span class="line"></span><br><span class="line">● 掌握中英文名称文件下载程序的编写</span><br><span class="line"></span><br><span class="line">## 16.1 文件上传</span><br><span class="line"></span><br><span class="line">- 文件上传表单必须要满足条件</span><br><span class="line"></span><br><span class="line">  - · form表单的method属性设置为**post**。</span><br><span class="line">  - · form表单的**enctype**属性设置为**multipart/form-data**。</span><br><span class="line">    - 当客户端form表单的enctype属性为multipart/form-data时，浏览器就会采用二进制流的方式来处理表单数据，服务器端就会对文件上传的请求进行解析处理。</span><br><span class="line">  - · 提供&lt;input type=&quot;file&quot; name=&quot;filename&quot; /&gt;的文件上传输入框。</span><br><span class="line"></span><br><span class="line">  ```xml</span><br><span class="line">  &lt;form action=&quot;uploadUrl&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">      &lt;input type=&quot;file&quot; name=&quot;filename&quot; multiple=&quot;multiple&quot;/&gt;</span><br><span class="line">      &lt;input type=&quot;submit&quot; value=&quot;文件上传&quot;/&gt;</span><br><span class="line">  &lt;/form&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>MultipartResolver：SpringMVC提供的一种文件解析器</p>
<ul>
<li>&#96;&#96;&#96;xml<!--MultipartResolver接口的Bean定义-->
<bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
    <!--设置编码格式，默认为ISO-8859-1-->
    <property name="defaultEncoding" value="UTF-8"/>
    <!--设置允许上传最大值(2MB),单位为字节-->
    <property name="maxUploadSize" value="2097152"/>
    ...
</bean>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - CommonsMultipartResolverde的属性：</span><br><span class="line"></span><br><span class="line">    - **· maxUploadSize：**上传文件最大长度（以字节为单位）。</span><br><span class="line">    - **· maxInMemorySize：**缓存中的最大尺寸。</span><br><span class="line">    - **· defaultEncoding：**默认编码格式。</span><br><span class="line">    - **· resolveLazily：**推迟文件解析，以便在Controller中捕获文件大小异常。</span><br><span class="line"></span><br><span class="line">  - **注意：**因为MultipartResolver接口的实现类CommonsMultipartResolver内部是引用multipartResolver字符串获取该实现类对象并完成文件解析的，所以在配置CommonsMultipartResolver时必须指定该Bean的id为multipartResolver。</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">​       由于CommonsMultipartResolver是Spring MVC内部通过Apache Commons FileUpload技术实现的，所以Spring MVC的文件上传还需要依赖Apache Commons FileUpload的组件</span><br><span class="line"></span><br><span class="line">- 需要导入坐标</span><br><span class="line"></span><br><span class="line">  - ```xml</span><br><span class="line">    &lt;!--文件上传--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.3.2&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;commons-io&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;commons-io&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.4&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>控制器书写</p>
<ul>
<li><p>&#96;&#96;&#96;java<br>package com.itzjc.controller;</p>
<p>import org.springframework.web.bind.annotation.RequestParam;<br>import org.springframework.web.multipart.MultipartFile;</p>
<p>public class FIleController {<br>public String handleFileUpload(@RequestParam(“name”) String name, @RequestParam(“filename”) MultipartFile file,…){<br>    if(!file.isEmpty()){<br>        &#x2F;&#x2F;具体方法<br>        return “uploadSuccess”;<br>        …<br>    }<br>    return “uploadFailure”;<br>}<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - file的方法</span><br><span class="line"></span><br><span class="line">    - ![1651418237254](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1651418237254.png)</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">- 实例演示</span><br><span class="line"></span><br><span class="line">- 1.编写配置文件</span><br><span class="line"></span><br><span class="line">  - ```xml</span><br><span class="line">    &lt;!--配置文件上传解析器--&gt;</span><br><span class="line">    &lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt;</span><br><span class="line">        &lt;!--设置编码格式，默认为ISO-8859-1--&gt;</span><br><span class="line">        &lt;property name=&quot;defaultEncoding&quot; value=&quot;UTF-8&quot;/&gt;</span><br><span class="line">        &lt;!--设置允许上传最大值(2MB),单位为字节--&gt;</span><br><span class="line">        &lt;property name=&quot;maxUploadSize&quot; value=&quot;2097152&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>2.编写前端代码</p>
<ul>
<li>&#96;&#96;&#96;jsp<br>&lt;%@ page contentType&#x3D;”text&#x2F;html;charset&#x3D;UTF-8” language&#x3D;”java” %&gt;<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>文件上传</title>
    <script>
        //判断是否填写上传人并已经选择上传文件
        function check(){
            var name = document.getElementById("name").value;
            var file = document.getElementById("file").value;
            if(name == ""){
                alert("填写上传人");
                return false;
            }
            if (file.length==0||file==""){
                alert("请选择上传文件")
                return false;
            }
            return true;
        }
    </script>
</head>
<body>
<form action="${pageContext.request.contextPath}/fileUpload" method="post" enctype="multipart/form-data" onsubmit="return check()">
    上传人:<input type="text" id="name" name="name"><br>
    请选择文件：<input id="file" type="file" name="uploadfile" multiple="multiple"><br>
    <input type="submit" value="上传">
</form>

</body>
</html>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 3.、编写文件上传控制器</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    package com.itzjc.controller;</span><br><span class="line">    </span><br><span class="line">    import org.springframework.stereotype.Controller;</span><br><span class="line">    import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">    import org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line">    import org.springframework.web.multipart.MultipartFile;</span><br><span class="line">    </span><br><span class="line">    import javax.servlet.http.HttpServletRequest;</span><br><span class="line">    import java.io.File;</span><br><span class="line">    import java.io.IOException;</span><br><span class="line">    import java.util.List;</span><br><span class="line">    import java.util.UUID;</span><br><span class="line">    @Controller</span><br><span class="line">    public class FIleController &#123;</span><br><span class="line">        /**</span><br><span class="line">         * 上传文件方法</span><br><span class="line">         * @param name 上传人</span><br><span class="line">         * @param uploadfile 文件</span><br><span class="line">         * @return 返回页面</span><br><span class="line">         */</span><br><span class="line">        @RequestMapping(&quot;/fileUpload&quot;)</span><br><span class="line">        public String handleFileUpload(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;uploadfile&quot;) List&lt;MultipartFile&gt; uploadfile, HttpServletRequest request)&#123;</span><br><span class="line">            if(!uploadfile.isEmpty() &amp;&amp; uploadfile.size() &gt; 0)&#123;</span><br><span class="line">                //循环输出上传文件</span><br><span class="line">                for (MultipartFile file : uploadfile) &#123;</span><br><span class="line">                    //获取上传文件的原始名称</span><br><span class="line">                    String originalFilename = file.getOriginalFilename();</span><br><span class="line">                    //设置上传文件的保存地址目录</span><br><span class="line">                    String realPath = request.getServletContext().getRealPath(&quot;/upload/&quot;);</span><br><span class="line">                    File filePath = new File(realPath);</span><br><span class="line">                    //如果保存文件的地址不存在，就先创建</span><br><span class="line">                    if (!filePath.exists())&#123;</span><br><span class="line">                        filePath.mkdirs();</span><br><span class="line">                    &#125;</span><br><span class="line">                    //使用UUID重新命名上传的文件名称(上传人_uuid_原始文件名称)</span><br><span class="line">                    String newFilename = name + &quot;_&quot; + UUID.randomUUID() + &quot;_&quot; + originalFilename;</span><br><span class="line">                    //使用MultipartFile接口的方法完成文件上传到指定的位置</span><br><span class="line">                    try &#123;</span><br><span class="line">                        file.transferTo(new File(realPath + newFilename));</span><br><span class="line">                    &#125; catch (IOException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                return &quot;success&quot;;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                return &quot;error&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h1 id="17-Spring整合"><a href="#17-Spring整合" class="headerlink" title="17.Spring整合"></a>17.Spring整合</h1><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1651763055035.png" alt="1651763055035"></p>
<ul>
<li>​        在实际开发时，为了避免Spring配置文件中的信息过于臃肿，通常会将Spring配置文件中的信息按照不同的功能分散在多个配置文件中。例如可以将事务配置放置在名称为applicationContext-transaction.xml的文件中，将数据源等信息放置在名称为applicationContext-db.xml的文件中等。这样，在web.xml中配置加载Spring文件信息时，只需通过applicationContext-*.xml的方式即可自动加载全部配置文件。<ul>
<li>​	     在前面小节整合环境搭建时，已经在配置文件applicationContext.xml中使用包扫描的形式加入了扫描包com.itheima.dao下的所有接口及映射文件，所以在这里完成DAO层接口及映射文件开发后，就不必再进行映射文件的扫描配置了。</li>
<li>​        @Transactional注解主要是针对数据的增加、修改、删除进行事务管理，上示例中的查询方法并不需要使用该注解，此处的作用就是告知读者该注解在实际开发中应该如何使用。</li>
</ul>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://bigfunny.github.io">BigFunny</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://bigfunny.github.io/post/6c92115f.html">https://bigfunny.github.io/post/6c92115f.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://bigfunny.github.io" target="_blank">BigFunny</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Spring/">Spring</a></div><div class="post_share"><div class="social-share" data-image="https://images4.alphacoders.com/682/682865.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/reward.jpg" target="_blank"><img class="post-qr-code-img" src="/img/reward.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/7678a22a.html"><img class="prev-cover" src="https://w.wallhaven.cc/full/j3/wallhaven-j3g7yy.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">泛型</div></div></a></div><div class="next-post pull-right"><a href="/post/28877bf.html"><img class="next-cover" src="https://wallroom.io/img/3840x2160/bg-2ba6ba8.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">异常处理</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">BigFunny</div><div class="author-info__description">天下事有难易乎，为之，则难者亦易矣；不为，则易者亦难矣。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">40</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/bigFunny"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/bigFunny" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:925825645@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/img/wechat.jpg" target="_blank" title="wechat"><i class="fa-brands fa-weixin"></i></a><a class="social-icon" href="/img/qq.jpg" target="_blank" title="qq"><i class="fa-brands fa-qq"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">本人是个小菜狗，关于技术性问题，可加我v讨论，随时欢迎哦!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Spring%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">1. Spring概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AFSpring"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 什么是Spring</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-Spring%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 Spring框架的优点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-Spring%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 Spring体系结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Core-Container%EF%BC%88%E6%A0%B8%E5%BF%83%E5%AE%B9%E5%99%A8%EF%BC%89"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.Core Container（核心容器）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Data-Access-x2F-Integration%EF%BC%88%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE-x2F-%E9%9B%86%E6%88%90%EF%BC%89"><span class="toc-number">1.3.2.</span> <span class="toc-text">2.Data Access&#x2F;Integration（数据访问&#x2F;集成）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Web"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.Web</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8E%E5%85%B6%E4%BB%96%E6%A8%A1%E5%9D%97"><span class="toc-number">1.3.4.</span> <span class="toc-text">4．其他模块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-IoC%E5%92%8CDI"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 IoC和DI</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Spring%E7%9A%84Bean"><span class="toc-number">2.</span> <span class="toc-text">2.Spring的Bean</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1Bean%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">2.1.</span> <span class="toc-text">2.1Bean的配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2Bean%E4%B8%AD%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%8E%B7%E5%8F%96"><span class="toc-number">2.2.</span> <span class="toc-text">2.2Bean中对象的获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">2.3.</span> <span class="toc-text">2.3Bean的作用域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 Bean的生命周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-Bean%E7%9A%84%E8%A3%85%E9%85%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 Bean的装配方式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Spring-AOP"><span class="toc-number">3.</span> <span class="toc-text">3.Spring AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E4%BB%80%E4%B9%88%E6%98%AFAOP"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 什么是AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-AOP%E4%B8%93%E4%B8%9A%E6%9C%AF%E8%AF%AD"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1 AOP专业术语</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 动态代理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%EF%BC%88%E4%B8%80%E5%AE%9A%E9%9C%80%E8%A6%81%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3%EF%BC%89"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 JDK动态代理（一定需要实现接口）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-CGLIB%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 CGLIB动态代理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%9F%BA%E4%BA%8E%E4%BB%A3%E7%90%86%E7%B1%BB%E7%9A%84AOP%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 基于代理类的AOP实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1Spring%E7%9A%84%E9%80%9A%E7%9F%A5%E6%96%B9%E5%BC%8F"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1Spring的通知方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-ProxyFactoryBean"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2 ProxyFactoryBean</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.3.3.</span> <span class="toc-text">3.3.3 代码实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4AspectJ%E5%BC%80%E5%8F%91"><span class="toc-number">3.4.</span> <span class="toc-text">3.4AspectJ开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-%E5%9F%BA%E4%BA%8EXML%E7%9A%84%E5%A3%B0%E6%98%8E%E5%BC%8FAspectJ"><span class="toc-number">3.4.1.</span> <span class="toc-text">3.4.1 基于XML的声明式AspectJ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%A3%B0%E6%98%8E%E5%BC%8FAspectJ"><span class="toc-number">3.4.2.</span> <span class="toc-text">3.4.2 基于注解的声明式AspectJ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-AOP%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93"><span class="toc-number">3.4.3.</span> <span class="toc-text">3.5 AOP知识总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ProceedingJoinPoint%EF%BC%9A%E7%BB%A7%E6%89%BF%E4%BA%86-JoinPoint%EF%BC%8C%E6%98%AF%E5%9C%A8JoinPoint%E7%9A%84%E5%9F%BA%E7%A1%80%E4%B8%8A%E6%9A%B4%E9%9C%B2%E5%87%BA-proceed-%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E3%80%82"><span class="toc-number">3.4.3.1.</span> <span class="toc-text">ProceedingJoinPoint：继承了 JoinPoint，是在JoinPoint的基础上暴露出 proceed 这个方法。</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Spring%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%80%E5%8F%91"><span class="toc-number">4.</span> <span class="toc-text">4.Spring数据库开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-Spring-JDBC"><span class="toc-number">4.0.1.</span> <span class="toc-text">4.1 Spring   JDBC</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Spring%E7%9A%84%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">5.Spring的事务管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E6%A6%82%E8%BF%B0"><span class="toc-number">5.1.</span> <span class="toc-text">5.1事务管理概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E4%BA%8B%E5%8A%A1%E7%9A%84%E7%AE%A1%E7%90%86%E6%96%B9%E5%BC%8F"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 事务的管理方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 声明式事务管理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%88%9D%E5%A7%8BMybatis"><span class="toc-number">6.</span> <span class="toc-text">6.初始Mybatis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-MyBatis%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 MyBatis的基础知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-MyBatis%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 MyBatis的工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E7%AC%AC%E4%B8%80%E4%B8%AAMyBatis%E7%A8%8B%E5%BA%8F"><span class="toc-number">6.3.</span> <span class="toc-text">6.3 第一个MyBatis程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%85%83%E7%B4%A0"><span class="toc-number">6.4.</span> <span class="toc-text">7.2 配置文件的元素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E5%85%83%E7%B4%A0"><span class="toc-number">6.5.</span> <span class="toc-text">7.3 映射文件中常用的元素</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E5%8A%A8%E6%80%81sql"><span class="toc-number">7.</span> <span class="toc-text">8.动态sql</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-4%E4%B8%80%E5%AF%B9%E5%A4%9A"><span class="toc-number">7.1.</span> <span class="toc-text">9.4一对多</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-MyBatis%E4%B8%8ESpring%E6%95%B4%E5%90%88"><span class="toc-number">8.</span> <span class="toc-text">10.MyBatis与Spring整合</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1%E6%95%B4%E5%90%88%E9%85%8D%E7%BD%AE"><span class="toc-number">8.1.</span> <span class="toc-text">10.1整合配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-%E4%BC%A0%E7%BB%9FDAO%E6%96%B9%E5%BC%8F%E6%95%B4%E5%90%88"><span class="toc-number">8.2.</span> <span class="toc-text">10.2 传统DAO方式整合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-3-%E5%9F%BA%E4%BA%8EMapperFactoryBean%E7%9A%84%E6%95%B4%E5%90%88"><span class="toc-number">8.3.</span> <span class="toc-text">10.3 基于MapperFactoryBean的整合</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-SpringMVC%E5%85%A5%E9%97%A8"><span class="toc-number">9.</span> <span class="toc-text">10.SpringMVC入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-SpringMVC%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">9.1.</span> <span class="toc-text">10.1 SpringMVC的特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-%E5%85%A5%E9%97%A8%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99"><span class="toc-number">9.2.</span> <span class="toc-text">10.2 入门程序编写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-3-%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="toc-number">9.3.</span> <span class="toc-text">12.3 视图解析器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A"><span class="toc-number">10.</span> <span class="toc-text">13.数据绑定</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#13-1-%E6%A6%82%E5%BF%B5"><span class="toc-number">10.1.</span> <span class="toc-text">13.1 概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-2-%E7%AE%80%E5%8D%95%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A"><span class="toc-number">10.2.</span> <span class="toc-text">13.2 简单数据绑定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-3-%E5%A4%8D%E6%9D%82%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A"><span class="toc-number">10.3.</span> <span class="toc-text">13.3 复杂数据绑定</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#14-JSON%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92%E5%92%8CRESTful%E6%94%AF%E6%8C%81"><span class="toc-number">11.</span> <span class="toc-text">14.JSON数据交互和RESTful支持</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#14-1-JSON%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">11.1.</span> <span class="toc-text">14.1 JSON数据结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-2-SpringMVC%E4%B8%ADJSON%E6%95%B0%E6%8D%AE%E4%BD%BF%E7%94%A8"><span class="toc-number">11.2.</span> <span class="toc-text">14.2 SpringMVC中JSON数据使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-3-RESTful%E6%94%AF%E6%8C%81"><span class="toc-number">11.3.</span> <span class="toc-text">14.3 RESTful支持</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#15-%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">12.</span> <span class="toc-text">15.拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#15-1-%E6%8B%A6%E6%88%AA%E5%99%A8%E7%9A%84%E5%AE%9A%E4%B9%89%E5%92%8C%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="toc-number">12.1.</span> <span class="toc-text">15.1 拦截器的定义和配置方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-2-%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">12.2.</span> <span class="toc-text">15.2 执行流程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#17-Spring%E6%95%B4%E5%90%88"><span class="toc-number">13.</span> <span class="toc-text">17.Spring整合</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/c0add594.html" title="vue"><img src="https://images3.alphacoders.com/632/632075.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="vue"/></a><div class="content"><a class="title" href="/post/c0add594.html" title="vue">vue</a><time datetime="2022-11-16T12:54:11.000Z" title="发表于 2022-11-16 20:54:11">2022-11-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/e5a21adb.html" title="css3"><img src="https://images4.alphacoders.com/682/682865.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="css3"/></a><div class="content"><a class="title" href="/post/e5a21adb.html" title="css3">css3</a><time datetime="2022-11-15T10:59:04.000Z" title="发表于 2022-11-15 18:59:04">2022-11-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/b92db53e.html" title="JS"><img src="https://wallroom.io/img/3840x2160/bg-2ba6ba8.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JS"/></a><div class="content"><a class="title" href="/post/b92db53e.html" title="JS">JS</a><time datetime="2022-11-12T07:21:56.000Z" title="发表于 2022-11-12 15:21:56">2022-11-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/4b0178e0.html" title="数据结构与算法"><img src="https://images6.alphacoders.com/670/670517.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据结构与算法"/></a><div class="content"><a class="title" href="/post/4b0178e0.html" title="数据结构与算法">数据结构与算法</a><time datetime="2022-11-11T12:32:16.000Z" title="发表于 2022-11-11 20:32:16">2022-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/dbb714e3.html" title="python爬虫"><img src="https://wallroom.io/img/3840x2160/bg-2ba6ba8.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="python爬虫"/></a><div class="content"><a class="title" href="/post/dbb714e3.html" title="python爬虫">python爬虫</a><time datetime="2022-11-09T07:26:33.000Z" title="发表于 2022-11-09 15:26:33">2022-11-09</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://images4.alphacoders.com/682/682865.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2022 By BigFunny</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">感谢您的观看！</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简体</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="fa-solid fa-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="fa-solid fa-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="fa-solid fa-arrow-rotate-right"></i></div><div class="rightMenu-item" id="menu-home"><i class="fa-solid fa-house"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" href="/archives/"><i class="fa-solid fa-archive"></i><span>文章归档</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="fa-solid fa-folder-open"></i><span>文章分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="fa-solid fa-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuNormal"><a class="rightMenu-item menu-link" id="menu-radompage" href="/index.html"><i class="fa-solid fa-shoe-prints"></i><span>随便逛逛</span></a><div class="rightMenu-item" id="menu-darkmode"><i class="fa-solid fa-moon"></i><span>切换模式</span></div><div class="rightMenu-item" id="menu-print"><i class="fa-solid fa-print fa-fw"></i><span>打印页面</span></div></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script data-pjax defer src="https://npm.elemecdn.com/tzy-blog/lib/js/theme/chocolate.js"></script><script defer data-pjax src="/js/rightMenu.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>